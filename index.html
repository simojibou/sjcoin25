<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SJ Missions</title>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background-image: url('/images/bg.png');
      background-size: cover;
    }
  </style>
</head>
<body class="flex flex-col justify-end min-h-screen px-6 pb-24 mt-12 text-white">
  <div class="mt-4" id="user-details">
    <!-- User Game Details Placeholder -->
  </div>

  <div class="flex justify-center items-center mt-10 space-x-1 text-yellow-400 text-3xl font-bold">
    <img src="/images/coins.png" class="w-14 h-14" />
    <span id="user-balance">0</span>
  </div>

  <div class="mt-10">
    <div id="mission-types" class="flex gap-4"></div>
    <div class="grid grid-cols-2 gap-3 mt-6" id="missions-list">
      <!-- Missions will be inserted here -->
    </div>
  </div>

  <!-- Mission Drawer -->
  <div id="mission-drawer" class="hidden fixed inset-0 bg-black bg-opacity-80 flex justify-center items-center z-50">
    <div class="bg-white text-black p-6 rounded-xl max-w-md w-full">
      <h2 id="mission-name" class="text-xl font-bold mb-2"></h2>
      <p id="mission-desc" class="mb-4 text-sm"></p>
      <button onclick="closeDrawer()" class="px-4 py-2 bg-red-600 text-white rounded">Close</button>
    </div>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCw46Dkka-64h7Rc3VIS9fZmvrfvbUCTjY",
      authDomain: "metawarefare-gaming.firebaseapp.com",
      projectId: "metawarefare-gaming"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Fake user data
    let user = {
      balance: 999,
      level: 1,
      totalReferals: 0
    };

    document.getElementById("user-balance").textContent = user.balance.toLocaleString();

    const missionTypes = [
      { id: 'social', name: 'Social' },
      { id: 'downloads', name: 'Downloads' }
    ];

    let activeType = missionTypes[0].id;

    const missionTypesContainer = document.getElementById('mission-types');
    const missionsList = document.getElementById('missions-list');

    missionTypes.forEach(type => {
      const btn = document.createElement('button');
      btn.textContent = type.name;
      btn.className = "text-xs font-bold uppercase opacity-100 bg-white text-black px-2 py-1 rounded";
      btn.onclick = () => {
        activeType = type.id;
        fetchMissions();
      };
      missionTypesContainer.appendChild(btn);
    });

    function fetchMissions() {
      missionsList.innerHTML = '<p class="col-span-2 text-center text-sm">Loading missions...</p>';

      db.collection("missions")
        .where("type", "==", activeType)
        .get()
        .then(snapshot => {
          missionsList.innerHTML = "";
          snapshot.forEach(doc => {
            const mission = doc.data();

            const locked =
              (mission.required_user_level && mission.required_user_level > user.level) ||
              (mission.required_friends_invitation && mission.required_friends_invitation > user.totalReferals);

            const div = document.createElement("div");
            div.className = `p-3 bg-gray-800 text-white rounded-xl cursor-pointer ${
              locked ? "opacity-40 cursor-not-allowed" : ""
            }`;

            div.innerHTML = `
              <div class="flex items-start space-x-3">
                <img src="${mission.image}" class="w-16 h-16 rounded" />
                <div>
                  <p class="text-[10px] font-bold">${mission.name}</p>
                  <p class="mt-1 text-[10px]">Profit per hour</p>
                  <p class="mt-2 text-[10px] font-bold text-green-400">+${mission.production_per_hour} SJ</p>
                </div>
              </div>
            `;

            if (!locked) {
              div.onclick = () => openDrawer(mission);
            }

            missionsList.appendChild(div);
          });
        });
    }

    function openDrawer(mission) {
      document.getElementById("mission-name").textContent = mission.name;
      document.getElementById("mission-desc").textContent = mission.description || "No description";
      document.getElementById("mission-drawer").classList.remove("hidden");
    }

    function closeDrawer() {
      document.getElementById("mission-drawer").classList.add("hidden");
    }

    fetchMissions();
  </script>
</body>
</html>
