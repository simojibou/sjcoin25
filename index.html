<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SJ COIN Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js"></script>
  <style>
    body { font-family: Arial; padding: 2rem; background: #f3f6ff; }
    h1 { color: #333; }
    .card {
      background: #fff;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    button {
      padding: 0.6rem 1rem;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h1>SJ COIN Admin Panel</h1>

  <div class="card">
    <h3>📊 إجمالي المستخدمين: <span id="userCount">0</span></h3>
    <h3>💰 إجمالي الرصيد: <span id="totalCoins">0</span> SJ</h3>
  </div>

  <div class="card">
    <h3>🔧 أضف رصيد لمستخدم</h3>
    <input type="text" id="userId" placeholder="User ID (UID)" />
    <input type="number" id="coinAmount" placeholder="Amount" />
    <button onclick="addCoins()">Add Coins</button>
  </div>

  <div class="card">
    <h3>📦 سجل الطلبات</h3>
    <ul id="ordersList"></ul>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCw46Dkka-64h7Rc3VIS9fZmvrfvbUCTjY",
        authDomain: "metawarefare-gaming.firebaseapp.com",
        databaseURL: "https://metawarefare-gaming-default-rtdb.firebaseio.com",
        projectId: "metawarefare-gaming",
        storageBucket: "metawarefare-gaming.appspot.com",
        messagingSenderId: "551352148152",
        appId: "1:551352148152:web:1b8fe7257e19fba720d44d",
        measurementId: "G-0TNLGL3XBX"
    };

    // Init Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Load Data
    async function loadDashboard() {
      // Get users
      const usersSnapshot = await db.collection("users").get();
      document.getElementById('userCount').innerText = usersSnapshot.size;

      let total = 0;
      usersSnapshot.forEach(doc => {
        total += doc.data().balance || 0;
      });
      document.getElementById('totalCoins').innerText = total;

      // Load Orders
      const orders = await db.collection("orders").orderBy("timestamp", "desc").limit(10).get();
      const ordersList = document.getElementById("ordersList");
      orders.forEach(doc => {
        const data = doc.data();
        const li = document.createElement("li");
        li.innerText = `${data.user}: ${data.amount} SJ via ${data.method}`;
        ordersList.appendChild(li);
      });
    }

    // Add coins
    async function addCoins() {
      const uid = document.getElementById("userId").value;
      const amount = parseInt(document.getElementById("coinAmount").value);

      if (!uid || isNaN(amount)) return alert("املأ كل الحقول بشكل صحيح");

      const userRef = db.collection("users").doc(uid);
      const userDoc = await userRef.get();

      if (!userDoc.exists) return alert("المستخدم غير موجود");

      const currentBalance = userDoc.data().balance || 0;
      await userRef.update({ balance: currentBalance + amount });
      alert("تم إضافة الرصيد بنجاح!");
      loadDashboard();
    }

    // Run on load
    loadDashboard();
  </script>

</body>
</html>
