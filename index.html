<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Customize Telegram Mini App Theme</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      min-height: 100vh;
      padding: 16px;
      background-color: white;
      color: #000;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 24px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }
    input[type="color"] {
      width: 100%;
      height: 40px;
      border-radius: 6px;
      border: 1px solid #ccc;
      cursor: pointer;
    }
    .section {
      background: rgba(255 255 255 / 0.1);
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 24px;
    }
    pre {
      background: rgba(0 0 0 / 0.2);
      padding: 16px;
      border-radius: 8px;
      overflow-x: auto;
    }
    .error {
      background-color: #ffe2e2;
      border: 1px solid #ff8a8a;
      color: #d8000c;
      padding: 16px;
      border-radius: 8px;
    }
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <div id="app"></div>

  <script>
    const app = document.getElementById('app');

    // تحقق هل التطبيق يعمل داخل Telegram Mini App
    const tg = window.Telegram?.WebApp;

    // الحالة الافتراضية للثيم
    const currentTheme = {
      headerColor: '#000000',
      bottomBarColor: '#1d2025',
      backgroundColor: '#ffffff',
    };

    function updateTheme(property, value) {
      if (tg) {
        tg[property] = value;
      }
      currentTheme[property] = value;
      renderCurrentSettings();
    }

    function renderError() {
      app.innerHTML = `
        <div class="error">
          <h1>This app only works in Telegram</h1>
          <p>Please open this application through Telegram Mini Apps.</p>
        </div>
      `;
    }

    function renderApp() {
      app.innerHTML = `
        <h1>Customize Telegram Mini App Theme</h1>
        
        <div class="section">
          <h2>Color Customization</h2>
          <div>
            <label for="headerColor">Header Color</label>
            <input type="color" id="headerColor" value="${currentTheme.headerColor}" />
          </div>
          <div>
            <label for="bottomBarColor">Bottom Bar Color</label>
            <input type="color" id="bottomBarColor" value="${currentTheme.bottomBarColor}" />
          </div>
          <div>
            <label for="backgroundColor">Background Color</label>
            <input type="color" id="backgroundColor" value="${currentTheme.backgroundColor}" />
          </div>
        </div>

        <div class="section">
          <h2>Current Settings</h2>
          <pre id="currentSettings">${JSON.stringify(currentTheme, null, 2)}</pre>
        </div>
      `;

      // أضف مستمعي الأحداث لعناصر input
      document.getElementById('headerColor').addEventListener('input', (e) => {
        updateTheme('headerColor', e.target.value);
      });
      document.getElementById('bottomBarColor').addEventListener('input', (e) => {
        updateTheme('bottomBarColor', e.target.value);
      });
      document.getElementById('backgroundColor').addEventListener('input', (e) => {
        updateTheme('backgroundColor', e.target.value);
        document.body.style.backgroundColor = e.target.value;
      });
    }

    function renderCurrentSettings() {
      const pre = document.getElementById('currentSettings');
      if (pre) {
        pre.textContent = JSON.stringify(currentTheme, null, 2);
      }
    }

    function init() {
      if (!tg) {
        renderError();
        return;
      }

      const initDataString = tg.initData;
      if (!initDataString) {
        renderError();
        return;
      }

      try {
        const urlParams = new URLSearchParams(initDataString);
        const user = JSON.parse(urlParams.get('user') || '{}');
        if (!user.id) {
          renderError();
          return;
        }
      } catch {
        renderError();
        return;
      }

      tg.ready();
      tg.expand();
      tg.enableVerticalSwipes();

      // تعيين ألوان افتراضية
      tg.headerColor = currentTheme.headerColor;
      tg.bottomBarColor = currentTheme.bottomBarColor;
      document.body.style.backgroundColor = currentTheme.backgroundColor;

      renderApp();
    }

    init();
  </script>
</body>
</html>
