<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home Page</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.24.0/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCw46Dkka-64h7Rc3VIS9fZmvrfvbUCTjY",
      authDomain: "metawarefare-gaming.firebaseapp.com",
      databaseURL: "https://metawarefare-gaming-default-rtdb.firebaseio.com",
      projectId: "metawarefare-gaming",
      storageBucket: "metawarefare-gaming.appspot.com",
      messagingSenderId: "551352148152",
      appId: "1:551352148152:web:1b8fe7257e19fba720d44d"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Mock level configuration
    const levelConfig = {
      bg: {
        1: '/images/background1.jpg',
        2: '/images/background2.jpg',
        // Add more backgrounds as needed
      }
    };

    // UserTap Component
    const UserTap = () => {
      const [user, setUser] = React.useState(null);
      const handleTap = async () => {
        if (user) {
          const userRef = db.collection('users').doc(user.uid);
          await userRef.update({
            balance: firebase.firestore.FieldValue.increment(1)
          });
        }
      };

      return (
        <div className="mt-6 text-center">
          <button 
            onClick={handleTap} 
            className="px-4 py-2 bg-blue-500 text-white rounded-full"
          >
            Tap to Earn
          </button>
        </div>
      );
    };

    // UserGameDetails Component
    const UserGameDetails = ({ className }) => {
      return (
        <div className={className}>
          <p className="text-white">Game Details Placeholder</p>
        </div>
      );
    };

    // Home Component
    const Home = () => {
      const [user, setUser] = React.useState(null);
      const [userData, setUserData] = React.useState({
        first_name: '',
        last_name: '',
        balance: 0,
        level: { level: 1, name: 'Beginner', to_balance: 1000 }
      });
      const maxLevel = 10; // Mock max level

      // Firebase auth state listener
      React.useEffect(() => {
        const unsubscribe = auth.onAuthStateChanged(async (firebaseUser) => {
          if (firebaseUser) {
            setUser(firebaseUser);
            const userRef = db.collection('users').doc(firebaseUser.uid);
            const doc = await userRef.get();
            if (doc.exists) {
              setUserData(doc.data());
            } else {
              // Initialize user data
              const initialData = {
                first_name: firebaseUser.displayName?.split(' ')[0] || 'User',
                last_name: firebaseUser.displayName?.split(' ')[1] || '',
                balance: 0,
                level: { level: 1, name: 'Beginner', to_balance: 1000 }
              };
              await userRef.set(initialData);
              setUserData(initialData);
            }
          } else {
            // Redirect to login or handle unauthenticated state
            setUser(null);
            setUserData({
              first_name: '',
              last_name: '',
              balance: 0,
              level: { level: 1, name: 'Beginner', to_balance: 1000 }
            });
          }
        });
        return () => unsubscribe();
      }, []);

      // Mock login function (for demo purposes)
      const handleLogin = () => {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider);
      };

      if (!user) {
        return (
          <div className="flex items-center justify-center h-screen bg-gray-900">
            <button 
              onClick={handleLogin}
              className="px-4 py-2 bg-blue-500 text-white rounded-full"
            >
              Login with Google
            </button>
          </div>
        );
      }

      return (
        <div
          className="flex-1 px-5 pb-20 bg-center bg-cover min-h-screen"
          style={{
            backgroundImage: `url(${levelConfig.bg[userData.level?.level || 1]})`,
          }}
        >
          <header className="flex items-center justify-between mt-4">
            <div className="flex items-center gap-2 px-3 py-2 border-2 rounded-full bg-black/20 border-white/10">
              <img
                src="/images/avatar.png"
                alt="user-avatar"
                className="object-cover w-8 h-8 rounded-full"
              />
              <p className="text-sm font-medium uppercase text-white">
                {userData.first_name} {userData.last_name}
              </p>
            </div>
          </header>
          <UserGameDetails className="mt-6" />
          <div className="flex mt-6 space-x-1.5 justify-center items-center select-none">
            <img
              src="/images/coins.png"
              alt="coins"
              className="object-contain w-20 h-20"
            />
            <span className="text-3xl font-bold text-gradient">
              {Math.floor(userData.balance).toLocaleString()}
            </span>
          </div>
          <div>
            <a
              href="/leaderboard"
              className="flex items-center justify-between gap-2 text-white"
            >
              <div className="flex items-center text-xs">
                <span>{userData.level?.name}</span>
              </div>
              <div className="flex items-center space-x-1">
                <span className="text-xs">Level</span>
                <span className="font-bold">
                  {userData.level?.level}/{maxLevel}
                </span>
              </div>
            </a>
            <div className="bg-[#FFDAA3]/10 border overflow-hidden border-[#FFDAA3]/10 rounded-full mt-2 h-4 w-full">
              <div
                className="bg-[linear-gradient(180deg,#FBEDE0_0%,#F7B87D_21%,#F3A155_52%,#E6824B_84%,#D36224_100%)] h-full"
                style={{
                  width: `${(userData.balance / userData.level.to_balance) * 100}%`,
                }}
              ></div>
            </div>
          </div>
          <UserTap />
        </div>
      );
    };

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<Home />);
  </script>
</body>
</html>
