<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Earn SJ Coins</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-image: url('/images/bg.png');
      background-size: cover;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      color: white;
    }
    .container {
      padding: 24px;
      margin-top: 48px;
      margin-bottom: 96px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    .header {
      text-align: center;
    }
    .header img {
      width: 128px;
      height: 128px;
      object-fit: contain;
    }
    .header h1 {
      font-size: 1.5rem;
      font-weight: bold;
      text-transform: uppercase;
      margin: 16px 0 10px;
    }
    .section-title {
      font-size: 1rem;
      font-weight: 500;
      text-align: center;
      margin: 32px 0 16px;
    }
    .task-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .task-item {
      display: flex;
      align-items: center;
      background-color: rgba(255, 255, 255, 0.1);
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: opacity 0.3s;
    }
    .task-item.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      filter: grayscale(50%);
    }
    .task-item img {
      width: 40px;
      height: 40px;
      object-fit: cover;
      border-radius: 4px;
      margin-right: 12px;
    }
    .task-info {
      flex: 1;
    }
    .task-info h3 {
      margin: 0;
      font-size: 1rem;
      font-weight: 500;
    }
    .task-info .price {
      color: #ffd700;
      font-size: 0.875rem;
    }
    .check-icon {
      width: 24px;
      height: 24px;
      color: #27d46c;
    }
    .loading {
      text-align: center;
      font-size: 1.2rem;
      padding: 50px;
    }
    .error {
      text-align: center;
      font-size: 1rem;
      color: #ff4d4d;
      padding: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="/images/coins.png" alt="Coins">
      <h1>Earn More SJ Coins</h1>
    </div>
    <div id="video-tasks">
      <p class="section-title">SJ Coin YouTube</p>
      <div class="task-list" id="video-task-list"></div>
    </div>
    <div id="daily-tasks">
      <p class="section-title">Daily Tasks</p>
      <div class="task-list" id="daily-task-list"></div>
    </div>
    <div id="other-tasks">
      <p class="section-title">All Tasks</p>
      <div class="task-list" id="other-task-list"></div>
    </div>
    <div id="referral-tasks">
      <p class="section-title">Referral Tasks</p>
      <div class="task-list" id="referral-task-list"></div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js"></script>
  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCw46Dkka-64h7Rc3VIS9fZmvrfvbUCTjY",
      authDomain: "metawarefare-gaming.firebaseapp.com",
      databaseURL: "https://metawarefare-gaming-default-rtdb.firebaseio.com",
      projectId: "metawarefare-gaming",
      storageBucket: "metawarefare-gaming.appspot.com",
      messagingSenderId: "551352148152",
      appId: "1:551352148152:web:1b8fe7257e19fba720d44d"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Tasks to add to the tasks collection
    const tasksToAdd = [
      {
        id: "video1",
        name: "Watch Tutorial Video",
        type: "video",
        reward_coins: 500,
        image: "/images/youtube.png",
        is_rewarded: false
      },
      {
        id: "other1",
        name: "Join Community",
        type: "other",
        reward_coins: 2000,
        image: "/images/bounty.png",
        is_rewarded: false
      }
    ];

    // Daily tasks to add to the DailyTasks collection
    const dailyTasksToAdd = [
      {
        id: "daily1",
        name: "Follow my Instagram",
        type: "daily",
        reward_coins: 1000,
        image: "/images/instagram.png",
        is_rewarded: false
      },
      {
        id: "daily2",
        name: "YouTube",
        type: "daily",
        reward_coins: 1000,
        image: "/images/youtube.png",
        is_rewarded: false
      },
      {
        id: "daily3",
        name: "Download",
        type: "daily",
        reward_coins: 1500,
        image: "/images/download.png",
        is_rewarded: false
      },
      {
        id: "daily4",
        name: "SJ Hero",
        type: "daily",
        reward_coins: 2000,
        image: "/images/sj-hero.png",
        is_rewarded: false
      },
      {
        id: "daily5",
        name: "SJ Store",
        type: "daily",
        reward_coins: 2000,
        image: "/images/sj-store.png",
        is_rewarded: false
      }
    ];

    // Function to add tasks to Firestore if they don't exist
    async function addTasksToFirestore() {
      try {
        // Add tasks to the tasks collection
        for (const task of tasksToAdd) {
          const docRef = db.collection('tasks').doc(task.id);
          const doc = await docRef.get();
          if (!doc.exists) {
            await docRef.set(task);
            console.log(`Added task: ${task.name}`);
          } else {
            console.log(`Task already exists: ${task.name}`);
          }
        }
        // Add daily tasks to the DailyTasks collection
        for (const task of dailyTasksToAdd) {
          const docRef = db.collection('DailyTasks').doc(task.id);
          const doc = await docRef.get();
          if (!doc.exists) {
            await docRef.set(task);
            console.log(`Added daily task: ${task.name}`);
          } else {
            console.log(`Daily task already exists: ${task.name}`);
          }
        }
      } catch (error) {
        console.error('Error adding tasks to Firestore:', error);
      }
    }

    // Function to format numbers with commas
    function formatNumber(num) {
      return num.toLocaleString();
    }

    // Function to render tasks
    function renderTasks(tasks, containerId, isReferral = false) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      if (tasks.length === 0) {
        container.innerHTML = '<p>No tasks available.</p>';
        return;
      }
      tasks.forEach(task => {
        const taskElement = document.createElement('div');
        taskElement.className = `task-item ${task.is_rewarded || task.is_completed ? 'disabled' : ''}`;
        taskElement.innerHTML = `
          <img src="${task.image || '/images/bounty.png'}" alt="${isReferral ? task.title : task.name}">
          <div class="task-info">
            <h3>${isReferral ? task.title : task.name}</h3>
            <div class="price">+${formatNumber(isReferral ? task.reward : task.reward_coins)} SJ Coins</div>
          </div>
          ${(task.is_rewarded || task.is_completed) ? '<svg class="check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>' : ''}
        `;
        taskElement.addEventListener('click', () => {
          if (!(task.is_rewarded || task.is_completed)) {
            alert(`Task: ${isReferral ? task.title : task.name}\nReward: ${formatNumber(isReferral ? task.reward : task.reward_coins)} SJ Coins`);
            // Add task action logic here (e.g., update Firestore, redirect to task URL)
          }
        });
        container.appendChild(taskElement);
      });
    }

    // Function to load tasks
    async function loadTasks() {
      try {
        // Show loading state
        document.querySelectorAll('.task-list').forEach(container => {
          container.innerHTML = '<p class="loading">Loading...</p>';
        });

        // Fetch tasks
        const tasksSnapshot = await db.collection('tasks').get();
        const tasks = tasksSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

        // Fetch daily tasks
        const dailyTasksSnapshot = await db.collection('DailyTasks').get();
        const dailyTasks = dailyTasksSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

        // Fetch referral tasks
        const referralTasksSnapshot = await db.collection('referral-tasks').get();
        const referralTasks = referralTasksSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

        // Filter tasks
        const videoTasks = tasks.filter(task => task.type === 'video');
        const otherTasks = tasks.filter(task => task.type === 'other');

        // Render tasks
        renderTasks(videoTasks, 'video-task-list');
        renderTasks(dailyTasks, 'daily-task-list');
        renderTasks(otherTasks, 'other-task-list');
        renderTasks(referralTasks, 'referral-task-list', true);

        // Hide sections with no tasks
        document.getElementById('video-tasks').style.display = videoTasks.length ? 'block' : 'none';
        document.getElementById('daily-tasks').style.display = dailyTasks.length ? 'block' : 'none';
        document.getElementById('other-tasks').style.display = otherTasks.length ? 'block' : 'none';
        document.getElementById('referral-tasks').style.display = referralTasks.length ? 'block' : 'none';
      } catch (error) {
        console.error('Error loading tasks:', error);
        document.querySelectorAll('.task-list').forEach(container => {
          container.innerHTML = '<p class="error">Error loading tasks.</p>';
        });
      }
    }

    // Initialize tasks and load them
    window.onload = async () => {
      await addTasksToFirestore();
      await loadTasks();
    };
  </script>
</body>
</html>
