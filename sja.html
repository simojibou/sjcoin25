```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SJ Affiliate Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.paypal.com/sdk/js?client-id=YOUR_SANDBOX_CLIENT_ID&currency=USD"></script>
</head>
<body class="bg-[#141414] text-white font-sans min-h-screen">
    <div id="login" class="flex items-center justify-center min-h-screen transition-opacity duration-500 opacity-100">
        <div class="bg-black/70 backdrop-blur-md p-8 rounded-xl shadow-2xl max-w-md w-full">
            <h1 class="text-4xl font-bold mb-6 text-center">Login with Google to Start</h1>
            <button id="loginBtn" class="bg-[#E50914] hover:bg-[#f6121d] text-white font-bold py-3 px-6 rounded w-full transition">Sign in with Google</button>
        </div>
    </div>

    <div id="payment" class="hidden fixed inset-0 flex items-center justify-center bg-black/80 z-50 transition-opacity duration-500 opacity-0">
        <div class="bg-black/70 backdrop-blur-md p-8 rounded-xl shadow-2xl max-w-md w-full">
            <h2 class="text-3xl font-bold mb-6 text-center">Choose Payment Method</h2>
            <div class="space-y-6">
                <div>
                    <h3 class="text-xl font-semibold mb-2">Pay $20 via PayPal</h3>
                    <div id="paypal-button-container" class="w-full"></div>
                </div>
                <div class="border-t border-gray-600 pt-4">
                    <h3 class="text-xl font-semibold mb-2">Or Enter Payment Code</h3>
                    <input id="codeInput" type="text" placeholder="Enter Payment Code" class="bg-gray-800 text-white p-3 rounded w-full mb-4">
                    <button id="codeBtn" class="bg-[#E50914] hover:bg-[#f6121d] text-white font-bold py-3 px-6 rounded w-full transition">Submit Code</button>
                </div>
            </div>
        </div>
    </div>

    <div id="dashboard" class="hidden p-4 transition-opacity duration-500 opacity-0">
        <header class="bg-black/50 backdrop-blur-md p-4 flex justify-between items-center rounded-xl mb-6 shadow-lg">
            <h1 class="text-2xl font-bold">SJ Affiliate Dashboard</h1>
            <img id="avatar" src="" alt="Avatar" class="w-10 h-10 rounded-full">
        </header>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-black/50 backdrop-blur-md p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-semibold mb-2">Affiliate Link</h2>
                <div class="flex">
                    <input id="affLink" type="text" readonly class="bg-gray-800 p-2 rounded-l w-full">
                    <button id="copyBtn" class="bg-[#E50914] hover:bg-[#f6121d] p-2 rounded-r">Copy</button>
                </div>
            </div>
            <div class="bg-black/50 backdrop-blur-md p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-semibold mb-2">Clicks</h2>
                <p class="text-3xl" id="clicks">0</p>
            </div>
            <div class="bg-black/50 backdrop-blur-md p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-semibold mb-2">Referrals</h2>
                <p class="text-3xl" id="referrals">0</p>
            </div>
            <div class="bg-black/50 backdrop-blur-md p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-semibold mb-2">Earnings</h2>
                <p class="text-3xl">$<span id="earnings">0</span></p>
            </div>
        </div>
    </div>

    <div id="admin" class="hidden p-4 transition-opacity duration-500 opacity-0">
        <h1 class="text-3xl font-bold mb-6">Admin Panel</h1>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-black/50 backdrop-blur-md p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-semibold mb-4">All Users</h2>
                <table class="w-full text-left" id="usersTable">
                    <thead>
                        <tr class="border-b border-gray-600">
                            <th class="py-2">Name</th>
                            <th>Email</th>
                            <th>Clicks</th>
                            <th>Referrals</th>
                            <th>Earnings</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="bg-black/50 backdrop-blur-md p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-semibold mb-4">Leaderboard (Top 10 by Earnings)</h2>
                <table class="w-full text-left" id="leaderboard">
                    <thead>
                        <tr class="border-b border-gray-600">
                            <th class="py-2">Rank</th>
                            <th>Name</th>
                            <th>Earnings</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="bg-black/50 backdrop-blur-md p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-semibold mb-4">Payment Codes</h2>
                <button id="addCodeBtn" class="bg-[#E50914] hover:bg-[#f6121d] text-white font-bold py-2 px-4 rounded mb-4">Add New Code</button>
                <table class="w-full text-left" id="codesTable">
                    <thead>
                        <tr class="border-b border-gray-600">
                            <th class="py-2">Code</th>
                            <th>Valid</th>
                            <th>Used By</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="bg-black/50 backdrop-blur-md p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-semibold mb-4">Total System Earnings</h2>
                <p class="text-4xl">$<span id="totalEarnings">0</span></p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js';
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js';
        import { getFirestore, collection, doc, getDoc, setDoc, updateDoc, addDoc, getDocs, orderBy, limit, query, arrayUnion, increment, serverTimestamp, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyD-sneIBO65i9uQIh3n_jw4MI7GQtjZfV8",
            authDomain: "sj-one.firebaseapp.com",
            databaseURL: "https://sj-one-default-rtdb.firebaseio.com",
            projectId: "sj-one",
            storageBucket: "sj-one.appspot.com",
            messagingSenderId: "426335553508",
            appId: "1:426335553508:web:248f76772f6f78419ca9f1",
            measurementId: "G-YQTVZQWXGB"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Extract referral ID from URL early
        const urlParams = new URLSearchParams(window.location.search);
        let refId = urlParams.get('ref');

        // Function to show an element with fade-in transition
        function showElement(id) {
            const el = document.getElementById(id);
            el.classList.remove('hidden');
            setTimeout(() => {
                el.classList.remove('opacity-0');
                el.classList.add('opacity-100');
            }, 10);
        }

        // Function to hide an element with fade-out transition
        function hideElement(id) {
            const el = document.getElementById(id);
            el.classList.remove('opacity-100');
            el.classList.add('opacity-0');
            setTimeout(() => {
                el.classList.add('hidden');
            }, 500);
        }

        // Handle login button click
        document.getElementById('loginBtn').addEventListener('click', async () => {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                console.error(error);
                alert('Login failed: ' + error.message);
            }
        });

        // Monitor authentication state changes
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                hideElement('login');
                const userRef = doc(db, 'users', user.uid);
                try {
                    const docSnap = await getDoc(userRef);
                    let userData;
                    if (!docSnap.exists()) {
                        userData = {
                            name: user.displayName,
                            email: user.email,
                            paid: user.email === 'simo.jibou@gmail.com',
                            balance: 0,
                            clicks: 0,
                            referrals: [],
                            affiliateLink: 'https://simojibou.github.io/sjcoin25/sja.html/?ref=' + user.uid
                        };
                        await setDoc(userRef, userData);
                    } else {
                        userData = docSnap.data();
                        if (user.email === 'simo.jibou@gmail.com' && !userData.paid) {
                            await updateDoc(userRef, { paid: true });
                            userData.paid = true;
                        }
                        const newAffLink = 'https://simojibou.github.io/sjcoin25/sja.html/?ref=' + user.uid;
                        if (userData.affiliateLink !== newAffLink) {
                            userData.affiliateLink = newAffLink;
                            await updateDoc(userRef, { affiliateLink: newAffLink });
                        }
                    }
                    // Increment clicks for referrer if refId is present and not self
                    if (refId && refId !== user.uid) {
                        const refRef = doc(db, 'users', refId);
                        await updateDoc(refRef, {
                            clicks: increment(1)
                        });
                    }
                    // Clear query params from URL
                    history.replaceState(null, '', window.location.pathname);
                    if (userData.paid) {
                        loadDashboard(user, userData);
                        showElement('dashboard');
                    } else {
                        loadPayment(user);
                        showElement('payment');
                    }
                    if (user.email === 'simo.jibou@gmail.com') {
                        await loadAdmin();
                        showElement('admin');
                    }
                } catch (error) {
                    console.error(error);
                    alert('Error loading user data: ' + error.message);
                }
            } else {
                showElement('login');
            }
        });

        // Load and populate dashboard data
        function loadDashboard(user, data) {
            document.getElementById('avatar').src = user.photoURL || '';
            document.getElementById('affLink').value = data.affiliateLink || '';
            document.getElementById('clicks').textContent = data.clicks || 0;
            document.getElementById('referrals').textContent = (data.referrals || []).length;
            document.getElementById('earnings').textContent = data.balance || 0;
            document.getElementById('copyBtn').addEventListener('click', () => {
                navigator.clipboard.writeText(data.affiliateLink || '');
                alert('Copied!');
            });
        }

        // Setup payment options (PayPal and code)
        function loadPayment(user) {
            // Initialize PayPal button
            paypal.Buttons({
                createOrder: (data, actions) => {
                    return actions.order.create({
                        purchase_units: [{
                            amount: {
                                value: '20.00'
                            }
                        }]
                    });
                },
                onApprove: async (data, actions) => {
                    try {
                        const details = await actions.order.capture();
                        await handlePaymentSuccess(user, 'paypal');
                    } catch (err) {
                        console.error(err);
                        alert('Payment capture error: ' + err.message);
                    }
                },
                onError: (err) => {
                    console.error(err);
                    alert('Payment error: ' + err.message);
                }
            }).render('#paypal-button-container');

            // Handle code submission
            document.getElementById('codeBtn').addEventListener('click', async () => {
                const code = document.getElementById('codeInput').value.trim();
                if (code) {
                    const codeRef = doc(db, 'codes', code);
                    try {
                        const docSnap = await getDoc(codeRef);
                        if (docSnap.exists() && docSnap.data().valid && !docSnap.data().usedBy) {
                            await updateDoc(codeRef, {
                                valid: false,
                                usedBy: user.uid
                            });
                            await handlePaymentSuccess(user, 'code');
                        } else {
                            alert('Invalid or used code');
                        }
                    } catch (error) {
                        console.error(error);
                        alert('Error validating code: ' + error.message);
                    }
                } else {
                    alert('Enter a code');
                }
            });
        }

        // Handle successful payment (common for PayPal and code)
        async function handlePaymentSuccess(user, method) {
            const userRef = doc(db, 'users', user.uid);
            try {
                await addDoc(collection(db, 'payments'), {
                    amount: 20,
                    userId: user.uid,
                    method: method,
                    timestamp: serverTimestamp()
                });
                await updateDoc(userRef, {
                    paid: true
                });
                // Credit referrer if applicable (only on first payment)
                if (refId && refId !== user.uid) {
                    const refRef = doc(db, 'users', refId);
                    await updateDoc(refRef, {
                        balance: increment(10),
                        referrals: arrayUnion(user.uid)
                    });
                }
                // Reload data and switch to dashboard
                const docSnap = await getDoc(userRef);
                hideElement('payment');
                loadDashboard(user, docSnap.data());
                showElement('dashboard');
            } catch (error) {
                console.error(error);
                alert('Error processing payment: ' + error.message);
            }
        }

        // Load admin panel data
        async function loadAdmin() {
            // Populate users table
            const usersTbody = document.querySelector('#usersTable tbody');
            try {
                const usersQuery = await getDocs(collection(db, 'users'));
                usersTbody.innerHTML = '';
                usersQuery.forEach((docSnap) => {
                    const data = docSnap.data();
                    const row = `<tr class="border-b border-gray-700">
                        <td class="py-2">${data.name || ''}</td>
                        <td>${data.email || ''}</td>
                        <td>${data.clicks || 0}</td>
                        <td>${(data.referrals || []).length}</td>
                        <td>$${data.balance || 0}</td>
                    </tr>`;
                    usersTbody.innerHTML += row;
                });
            } catch (error) {
                console.error(error);
            }

            // Populate leaderboard
            const leaderTbody = document.querySelector('#leaderboard tbody');
            try {
                const leaderQuery = query(collection(db, 'users'), orderBy('balance', 'desc'), limit(10));
                const leaderDocs = await getDocs(leaderQuery);
                leaderTbody.innerHTML = '';
                let rank = 1;
                leaderDocs.forEach((docSnap) => {
                    const data = docSnap.data();
                    const row = `<tr class="border-b border-gray-700">
                        <td class="py-2">${rank}</td>
                        <td>${data.name || ''}</td>
                        <td>$${data.balance || 0}</td>
                    </tr>`;
                    leaderTbody.innerHTML += row;
                    rank++;
                });
            } catch (error) {
                console.error(error);
            }

            // Calculate total system earnings
            try {
                const paymentsQuery = await getDocs(collection(db, 'payments'));
                let total = 0;
                paymentsQuery.forEach((docSnap) => {
                    total += docSnap.data().amount || 0;
                });
                document.getElementById('totalEarnings').textContent = total;
            } catch (error) {
                console.error(error);
            }

            // Function to load payment codes
            const codesTbody = document.querySelector('#codesTable tbody');
            async function loadCodes() {
                try {
                    const codesQuery = await getDocs(collection(db, 'codes'));
                    codesTbody.innerHTML = '';
                    codesQuery.forEach((docSnap) => {
                        const data = docSnap.data();
                        const valid = data.valid ? 'Yes' : 'No';
                        const usedBy = data.usedBy || '-';
                        const row = `<tr class="border-b border-gray-700">
                            <td class="py-2">${docSnap.id}</td>
                            <td>${valid}</td>
                            <td>${usedBy}</td>
                            <td><button class="deleteCode bg-red-600 hover:bg-red-700 text-white py-1 px-2 rounded" data-code="${docSnap.id}">Delete</button></td>
                        </tr>`;
                        codesTbody.innerHTML += row;
                    });
                    // Attach delete button listeners
                    document.querySelectorAll('.deleteCode').forEach(btn => {
                        btn.addEventListener('click', async () => {
                            const code = btn.dataset.code;
                            try {
                                await deleteDoc(doc(db, 'codes', code));
                                await loadCodes();
                            } catch (error) {
                                console.error(error);
                            }
                        });
                    });
                } catch (error) {
                    console.error(error);
                }
            }
            await loadCodes();

            // Handle adding new payment code
            document.getElementById('addCodeBtn').addEventListener('click', async () => {
                const code = Math.random().toString(36).substring(2, 10).toUpperCase();
                try {
                    await setDoc(doc(db, 'codes', code), {
                        valid: true,
                        usedBy: null
                    });
                    await loadCodes();
                } catch (error) {
                    console.error(error);
                }
            });
        }
    </script>
</body>
</html>
```
