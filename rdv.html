<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SJ Extractor V5 - Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>
    <style>
        body { background-color: #000; color: #fff; font-family: sans-serif; }
        .transparent-bg {
            background-image: linear-gradient(45deg, #333 25%, transparent 25%), 
                              linear-gradient(-45deg, #333 25%, transparent 25%), 
                              linear-gradient(45deg, transparent 75%, #333 75%), 
                              linear-gradient(-45deg, transparent 75%, #333 75%);
            background-size: 20px 20px;
            background-color: #1a1a1a;
        }
        canvas {
            width: 100%;
            height: auto;
            border: 1px solid #333;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div class="max-w-2xl w-full space-y-6">
        
        <div class="text-center border-b border-gray-800 pb-4">
            <h1 class="text-2xl font-bold text-white">SJ Logo Extractor V5</h1>
            <p class="text-gray-400 text-sm">Aggressive cleaning for 100% removal</p>
        </div>

        <!-- 1. Upload -->
        <div class="bg-gray-900 p-4 rounded-lg border border-gray-700">
            <label class="block text-xs font-bold text-cyan-400 mb-2 uppercase">1. Upload Video</label>
            <input type="file" id="videoInput" accept="video/*" class="w-full text-sm text-gray-400 file:bg-cyan-700 file:text-white file:border-0 file:rounded file:px-4 file:py-2 cursor-pointer">
        </div>

        <!-- 2. Controls -->
        <div class="bg-gray-900 p-4 rounded-lg border border-gray-700 space-y-6">
            <div class="flex justify-between items-center">
                <label class="text-sm font-bold text-cyan-400 uppercase">2. Output Mode</label>
                <div class="flex bg-black rounded-lg p-1 border border-gray-600">
                    <button id="modeTrans" class="px-4 py-1 rounded text-xs font-bold bg-cyan-600 text-white transition">Transparent</button>
                    <button id="modeBlack" class="px-4 py-1 rounded text-xs font-bold text-gray-400 hover:text-white transition">Solid Black</button>
                </div>
            </div>

            <div>
                <div class="flex justify-between text-xs mb-1">
                    <span>Cleaning Level (Threshold)</span>
                    <span id="threshVal" class="text-cyan-400">40</span>
                </div>
                <input type="range" id="threshold" min="0" max="100" value="40" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-cyan-500">
                <p class="text-[10px] text-gray-500 mt-1">Move Right ⮕ removes more background. Move Left ⬅ brings it back.</p>
            </div>

            <div>
                 <div class="flex justify-between text-xs mb-1">
                    <span>Logo Brightness Boost</span>
                    <span id="boostVal" class="text-cyan-400">1.5x</span>
                </div>
                <input type="range" id="boost" min="1.0" max="3.0" step="0.1" value="1.5" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-cyan-500">
            </div>
        </div>

        <!-- 3. Preview -->
        <div class="grid grid-cols-2 gap-4">
            <div>
                <p class="text-xs text-gray-500 mb-1">Original</p>
                <video id="sourceVideo" class="w-full rounded border border-gray-700" muted playsinline loop></video>
            </div>
            <div>
                <p class="text-xs text-gray-500 mb-1">Result Preview</p>
                <div id="canvasContainer" class="transparent-bg rounded overflow-hidden">
                    <canvas id="outputCanvas"></canvas>
                </div>
            </div>
        </div>

        <!-- 4. Export -->
        <button id="recordBtn" class="w-full py-4 bg-gradient-to-r from-green-600 to-emerald-700 hover:from-green-500 hover:to-emerald-600 text-white font-bold rounded shadow-lg disabled:opacity-50">
            Download Result
        </button>

        <!-- Hidden download links -->
        <div id="downloads" class="hidden text-center space-y-2 p-4 bg-gray-800 rounded">
            <p class="text-green-400 text-sm font-bold">Processing Complete!</p>
            <a id="dlGif" class="block text-xs text-white bg-gray-700 py-2 rounded hover:bg-gray-600 cursor-pointer">Download GIF</a>
        </div>

    </div>

    <script>
        // Setup
        const videoInput = document.getElementById('videoInput');
        const sourceVideo = document.getElementById('sourceVideo');
        const canvas = document.getElementById('outputCanvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        
        // UI
        const modeTrans = document.getElementById('modeTrans');
        const modeBlack = document.getElementById('modeBlack');
        const threshInput = document.getElementById('threshold');
        const boostInput = document.getElementById('boost');
        const threshVal = document.getElementById('threshVal');
        const boostVal = document.getElementById('boostVal');
        const recordBtn = document.getElementById('recordBtn');
        const downloads = document.getElementById('downloads');
        const dlGif = document.getElementById('dlGif');
        const canvasContainer = document.getElementById('canvasContainer');

        let isTransparent = true;
        let isRecording = false;
        let gif;
        let gifWorkerURL;

        // Fetch GIF Worker Code (bypass CORS)
        fetch('https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js')
            .then(r => r.text())
            .then(t => {
                const b = new Blob([t], {type: 'application/javascript'});
                gifWorkerURL = URL.createObjectURL(b);
            });

        // Mode Switching
        modeTrans.addEventListener('click', () => {
            isTransparent = true;
            modeTrans.classList.add('bg-cyan-600', 'text-white');
            modeTrans.classList.remove('text-gray-400');
            modeBlack.classList.remove('bg-cyan-600', 'text-white');
            modeBlack.classList.add('text-gray-400');
            canvasContainer.classList.add('transparent-bg');
        });

        modeBlack.addEventListener('click', () => {
            isTransparent = false;
            modeBlack.classList.add('bg-cyan-600', 'text-white');
            modeBlack.classList.remove('text-gray-400');
            modeTrans.classList.remove('bg-cyan-600', 'text-white');
            modeTrans.classList.add('text-gray-400');
            canvasContainer.classList.remove('transparent-bg');
        });

        // Sliders
        threshInput.addEventListener('input', (e) => threshVal.innerText = e.target.value);
        boostInput.addEventListener('input', (e) => boostVal.innerText = e.target.value + 'x');

        // Video Load
        videoInput.addEventListener('change', (e) => {
            if(e.target.files[0]) {
                sourceVideo.src = URL.createObjectURL(e.target.files[0]);
                sourceVideo.play();
                drawLoop();
            }
        });

        sourceVideo.addEventListener('loadedmetadata', () => {
             // Low res for speed & retro feel
             canvas.width = 300;
             canvas.height = (sourceVideo.videoHeight / sourceVideo.videoWidth) * 300;
        });

        // Processing Loop
        function drawLoop() {
            if(sourceVideo.paused && !isRecording) {
                requestAnimationFrame(drawLoop);
                return;
            }

            ctx.drawImage(sourceVideo, 0, 0, canvas.width, canvas.height);
            
            const frame = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = frame.data;
            const threshold = parseInt(threshInput.value);
            const boost = parseFloat(boostInput.value);

            for(let i=0; i<data.length; i+=4) {
                const r = data[i];
                const g = data[i+1];
                const b = data[i+2];

                // Calculate Brightness
                const brightness = (r + g + b) / 3;

                if (brightness < threshold) {
                    // Background
                    if (isTransparent) {
                        data[i+3] = 0; // Transparent
                    } else {
                        data[i] = 0;   // Black R
                        data[i+1] = 0; // Black G
                        data[i+2] = 0; // Black B
                        data[i+3] = 255; // Opaque
                    }
                } else {
                    // Logo
                    // Boost brightness to make it pop
                    data[i] = Math.min(255, r * boost);
                    data[i+1] = Math.min(255, g * boost);
                    data[i+2] = Math.min(255, b * boost);
                    data[i+3] = 255;
                }
            }

            ctx.putImageData(frame, 0, 0);

            if(isRecording && gif) {
                gif.addFrame(ctx, {copy: true, delay: 50});
            }

            requestAnimationFrame(drawLoop);
        }

        // Recording
        recordBtn.addEventListener('click', () => {
            if(isRecording) return;
            isRecording = true;
            recordBtn.innerText = "Recording... Wait.";
            recordBtn.disabled = true;
            downloads.classList.add('hidden');

            gif = new GIF({
                workers: 2,
                quality: 10,
                width: canvas.width,
                height: canvas.height,
                workerScript: gifWorkerURL,
                transparent: isTransparent ? 0x000000 : null,
                background: isTransparent ? '#000000' : '#000000'
            });

            sourceVideo.currentTime = 0;
            sourceVideo.play();

            // Record for 4 seconds (approx length of loop)
            setTimeout(() => {
                isRecording = false;
                recordBtn.innerText = "Processing GIF...";
                
                gif.on('finished', (blob) => {
                    dlGif.href = URL.createObjectURL(blob);
                    dlGif.download = isTransparent ? 'sj-logo-transparent.gif' : 'sj-logo-black.gif';
                    downloads.classList.remove('hidden');
                    recordBtn.innerText = "Download Result";
                    recordBtn.disabled = false;
                });
                
                gif.render();

            }, 4000);
        });

    </script>
</body>
</html>










