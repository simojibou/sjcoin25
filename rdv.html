<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SJ Professional Background Remover</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>
    <style>
        .checkerboard {
            background-color: #eee;
            background-image: linear-gradient(45deg, #ccc 25%, transparent 25%), 
                              linear-gradient(-45deg, #ccc 25%, transparent 25%), 
                              linear-gradient(45deg, transparent 75%, #ccc 75%), 
                              linear-gradient(-45deg, transparent 75%, #ccc 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        canvas {
            max-width: 100%;
            height: auto;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen font-sans">

    <div class="max-w-4xl mx-auto p-6">
        
        <!-- Header -->
        <div class="flex items-center justify-between mb-8 border-b border-slate-700 pb-4">
            <div>
                <h1 class="text-3xl font-bold text-cyan-400">SJ Logo Tool <span class="text-xs bg-cyan-900 text-cyan-300 px-2 py-1 rounded ml-2">PRO</span></h1>
                <p class="text-slate-400 text-sm mt-1">Remove black background & preserve glow</p>
            </div>
        </div>

        <!-- Main Workspace -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Panel: Controls -->
            <div class="lg:col-span-1 space-y-6">
                
                <!-- Upload -->
                <div class="bg-slate-800 p-4 rounded-lg border border-slate-700">
                    <label class="block text-sm font-medium text-slate-300 mb-2">1. Input Video</label>
                    <input type="file" id="videoInput" accept="video/*" class="block w-full text-sm text-slate-400
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-full file:border-0
                        file:text-sm file:font-semibold
                        file:bg-cyan-600 file:text-white
                        hover:file:bg-cyan-700 cursor-pointer
                    "/>
                </div>

                <!-- Settings -->
                <div class="bg-slate-800 p-4 rounded-lg border border-slate-700 space-y-4">
                    <h3 class="font-bold text-slate-200">2. Fine Tune</h3>
                    
                    <div>
                        <div class="flex justify-between text-xs mb-1">
                            <span>Black Removal Sensitivity</span>
                            <span id="threshVal" class="text-cyan-400">15</span>
                        </div>
                        <input type="range" id="threshold" min="0" max="60" value="15" class="w-full accent-cyan-500">
                        <p class="text-[10px] text-slate-500">Higher = removes more dark gray, but might eat into logo edges.</p>
                    </div>

                    <div>
                        <div class="flex justify-between text-xs mb-1">
                            <span>Glow Brightness (Opacity)</span>
                            <span id="alphaVal" class="text-cyan-400">1.5</span>
                        </div>
                        <input type="range" id="alphaBoost" min="0.5" max="3.0" step="0.1" value="1.5" class="w-full accent-cyan-500">
                        <p class="text-[10px] text-slate-500">Boost this if the logo looks too faint.</p>
                    </div>

                    <div>
                        <div class="flex justify-between text-xs mb-1">
                            <span>Resolution Scale</span>
                            <span id="scaleVal" class="text-cyan-400">50%</span>
                        </div>
                        <input type="range" id="scale" min="0.2" max="1.0" step="0.1" value="0.5" class="w-full accent-cyan-500">
                        <p class="text-[10px] text-slate-500">Lower resolution = Faster processing & smaller file size.</p>
                    </div>
                </div>

                <!-- Actions -->
                <div class="space-y-3">
                    <button id="recordBtn" class="w-full py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded shadow-lg transition flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                        <span class="w-3 h-3 bg-white rounded-full animate-pulse"></span>
                        Start Recording
                    </button>
                    <p class="text-xs text-center text-slate-500">Click Start, let video play, then click Stop.</p>
                </div>

            </div>

            <!-- Right Panel: Preview -->
            <div class="lg:col-span-2 space-y-4">
                <div class="flex justify-between items-center">
                    <h3 class="font-bold text-slate-200">Live Preview</h3>
                    <span id="status" class="text-xs font-mono text-cyan-400 hidden">Recording...</span>
                </div>
                
                <!-- Canvas Container -->
                <div class="relative bg-slate-900 rounded-lg overflow-hidden border border-slate-700 flex flex-col items-center justify-center min-h-[300px]">
                    <!-- Background Checkerboard -->
                    <div class="absolute inset-0 checkerboard opacity-20 pointer-events-none"></div>
                    
                    <!-- The Main Canvas -->
                    <canvas id="outputCanvas" class="relative z-10"></canvas>

                    <!-- Overlay for 'No Video' -->
                    <div id="placeholder" class="absolute inset-0 flex items-center justify-center text-slate-600 z-0">
                        <span>No video loaded</span>
                    </div>
                </div>

                <!-- Hidden Video Source -->
                <video id="sourceVideo" class="hidden" muted playsinline></video>

                <!-- Results Area -->
                <div id="results" class="hidden bg-slate-800 p-4 rounded border border-slate-600 mt-4 animate-fade-in">
                    <h3 class="text-lg font-bold text-white mb-3">âœ… Processing Complete</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="text-center p-3 bg-slate-900 rounded">
                            <h4 class="text-sm font-semibold text-cyan-400 mb-2">Format 1: WebM</h4>
                            <p class="text-xs text-slate-400 mb-2">High Quality, Full Transparency.<br>Best for Android/Web Apps.</p>
                            <a id="downloadWebm" class="inline-block px-4 py-2 bg-cyan-600 hover:bg-cyan-500 text-white text-xs font-bold rounded transition cursor-pointer">Download WebM</a>
                        </div>
                        <div class="text-center p-3 bg-slate-900 rounded">
                            <h4 class="text-sm font-semibold text-pink-400 mb-2">Format 2: GIF</h4>
                            <p class="text-xs text-slate-400 mb-2">Standard format.<br>Glow may look slightly grainy.</p>
                            <a id="downloadGif" class="text-xs text-slate-500">Processing GIF...</a>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- Configuration & State ---
        const videoInput = document.getElementById('videoInput');
        const sourceVideo = document.getElementById('sourceVideo');
        const canvas = document.getElementById('outputCanvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        
        // Controls
        const thresholdInput = document.getElementById('threshold');
        const alphaBoostInput = document.getElementById('alphaBoost');
        const scaleInput = document.getElementById('scale');
        const recordBtn = document.getElementById('recordBtn');
        
        // UI Text
        const threshVal = document.getElementById('threshVal');
        const alphaVal = document.getElementById('alphaVal');
        const scaleVal = document.getElementById('scaleVal');
        const statusLabel = document.getElementById('status');
        const placeholder = document.getElementById('placeholder');
        const resultsArea = document.getElementById('results');
        const downloadWebm = document.getElementById('downloadWebm');
        const downloadGif = document.getElementById('downloadGif');

        let isPlaying = false;
        let isRecording = false;
        let mediaRecorder;
        let recordedChunks = [];
        let gif;
        let scale = 0.5;

        // --- GIF Worker Fix ---
        // Load GIF worker from blob to avoid CORS issues
        let gifWorkerURL;
        fetch('https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js')
            .then(resp => resp.text())
            .then(code => {
                const blob = new Blob([code], { type: 'application/javascript' });
                gifWorkerURL = URL.createObjectURL(blob);
            });

        // --- Event Listeners ---

        videoInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const url = URL.createObjectURL(file);
            sourceVideo.src = url;
            placeholder.classList.add('hidden');
            resultsArea.classList.add('hidden');
        });

        sourceVideo.addEventListener('loadedmetadata', () => {
            resizeCanvas();
            sourceVideo.play(); // Start preview loop
            isPlaying = true;
            processLoop();
        });

        sourceVideo.addEventListener('ended', () => {
            if (isRecording) {
                stopRecording();
            } else {
                sourceVideo.currentTime = 0;
                sourceVideo.play();
            }
        });

        // Sliders
        thresholdInput.addEventListener('input', (e) => threshVal.innerText = e.target.value);
        alphaBoostInput.addEventListener('input', (e) => alphaBoostVal.innerText = e.target.value);
        scaleInput.addEventListener('input', (e) => {
            scaleVal.innerText = Math.round(e.target.value * 100) + '%';
            scale = parseFloat(e.target.value);
            resizeCanvas();
        });

        recordBtn.addEventListener('click', () => {
            if (!isRecording) startRecording();
            else stopRecording();
        });

        // --- Core Logic ---

        function resizeCanvas() {
            if (!sourceVideo.videoWidth) return;
            canvas.width = sourceVideo.videoWidth * scale;
            canvas.height = sourceVideo.videoHeight * scale;
        }

        function processLoop() {
            if (sourceVideo.paused && !isRecording) {
                // If paused and not recording, wait (unless scrubbing?)
                // Actually keep loop running for slider updates
            }
            
            if (sourceVideo.readyState >= 2) {
                // 1. Draw original video frame scaled
                ctx.drawImage(sourceVideo, 0, 0, canvas.width, canvas.height);
                
                // 2. Get Pixels
                const frame = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = frame.data;
                const len = data.length;
                
                const threshold = parseInt(thresholdInput.value);
                const boost = parseFloat(alphaBoostInput.value);

                // 3. PIXEL SHADER: Black to Transparent
                for (let i = 0; i < len; i += 4) {
                    const r = data[i];
                    const g = data[i+1];
                    const b = data[i+2];

                    // Calculate "Max Brightness" (Luma)
                    // This assumes the background is black and the logo is colored/white
                    let maxVal = Math.max(r, g, b);

                    if (maxVal < threshold) {
                        // It's pure background -> Transparent
                        data[i+3] = 0;
                    } else {
                        // It's part of the logo
                        // Set Alpha based on brightness
                        // This creates the "fade" effect for the glow
                        let alpha = maxVal * boost;
                        if (alpha > 255) alpha = 255;
                        
                        data[i+3] = alpha; 
                        
                        // Optional: Normalize color to prevent "dark halo"
                        // If we make it transparent, we should make the RGB color fully bright
                        // so the semi-transparent pixels rely on Alpha, not Dark RGB, to dim.
                        // However, for simple glow, keeping original RGB is usually safer visually.
                    }
                }

                // 4. Put modified pixels back
                ctx.putImageData(frame, 0, 0);

                // 5. If Recording, add to GIF
                if (isRecording && gif) {
                    gif.addFrame(ctx, {copy: true, delay: 20}); // Approx 50fps capture
                }
            }

            requestAnimationFrame(processLoop);
        }

        // --- Recording Logic ---

        function startRecording() {
            if (!sourceVideo.videoWidth) {
                alert("Please upload a video first");
                return;
            }

            isRecording = true;
            recordedChunks = [];
            
            // UI Update
            recordBtn.innerHTML = '<span class="w-3 h-3 bg-white rounded-sm"></span> Stop Recording';
            recordBtn.classList.replace('bg-red-600', 'bg-slate-600');
            statusLabel.classList.remove('hidden');
            resultsArea.classList.add('hidden');
            downloadGif.innerText = "Processing GIF...";
            downloadGif.classList.remove('bg-pink-600', 'hover:bg-pink-500', 'text-white', 'cursor-pointer');
            downloadGif.classList.add('text-slate-500');

            // 1. Setup WebM Recorder
            const stream = canvas.captureStream(30); // 30 FPS stream
            mediaRecorder = new MediaRecorder(stream, {
                mimeType: 'video/webm; codecs=vp9' // Supports Alpha
            });
            
            mediaRecorder.ondataavailable = (event) => {
                if (event.data.size > 0) recordedChunks.push(event.data);
            };
            mediaRecorder.start();

            // 2. Setup GIF Recorder
            gif = new GIF({
                workers: 2,
                quality: 10,
                width: canvas.width,
                height: canvas.height,
                workerScript: gifWorkerURL,
                transparent: 0x000000 // Tell GIF 0,0,0 is transparent
            });

            // 3. Reset Video to start
            sourceVideo.currentTime = 0;
            sourceVideo.play();
        }

        function stopRecording() {
            if (!isRecording) return;
            isRecording = false;

            // UI Update
            recordBtn.innerHTML = '<span class="w-3 h-3 bg-white rounded-full animate-pulse"></span> Start Recording';
            recordBtn.classList.replace('bg-slate-600', 'bg-red-600');
            statusLabel.classList.add('hidden');

            // 1. Stop WebM
            mediaRecorder.stop();
            mediaRecorder.onstop = () => {
                const blob = new Blob(recordedChunks, { type: 'video/webm' });
                const url = URL.createObjectURL(blob);
                downloadWebm.href = url;
                downloadWebm.download = "sj_logo_transparent.webm";
                
                resultsArea.classList.remove('hidden');
            };

            // 2. Finish GIF
            statusLabel.innerText = "Rendering GIF...";
            statusLabel.classList.remove('hidden');
            
            gif.on('finished', (blob) => {
                const url = URL.createObjectURL(blob);
                downloadGif.href = url;
                downloadGif.download = "sj_logo_transparent.gif";
                
                // Style the button
                downloadGif.innerText = "Download GIF";
                downloadGif.classList.remove('text-slate-500');
                downloadGif.classList.add('inline-block', 'px-4', 'py-2', 'bg-pink-600', 'hover:bg-pink-500', 'text-white', 'text-xs', 'font-bold', 'rounded', 'transition', 'cursor-pointer');
                
                statusLabel.classList.add('hidden');
            });
            
            gif.render();
        }

    </script>
</body>
</html>




