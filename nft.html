<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bybit Affiliate Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<style>
    .error-message { display: none; }
    .error-message.show { display: block; }
    img { max-width: 100px; height: auto; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }
    th { background-color: #f9fafb; font-weight: 600; }
    tr:hover { background-color: #f3f4f6; }
    @media (max-width: 640px) {
        img { max-width: 80px; }
        th, td { padding: 8px; font-size: 0.875rem; }
    }
</style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-6">
<div class="max-w-5xl w-full mx-auto bg-white rounded-lg shadow-lg p-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Bybit Affiliate Dashboard</h1>
    <div id="error" class="error-message text-red-600 font-semibold text-center mb-6 p-4 bg-red-50 rounded-lg"></div>
    <table id="affiliate-table" class="hidden">
        <thead>
            <tr>
                <th>Image</th>
                <th>Offer Name</th>
                <th>Commission</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody id="affiliate-list"></tbody>
    </table>
</div>

<script>
async function fetchAffiliateData() {
    const apiKey = 'noY0AxxNXNzlrJLsnp';
    const apiSecret = 'frLnT94oj8KJjRZVMr3RDoCrDX8Bb8Sli5dR';
    const apiUrl = 'https://api.bybit.com/v5/affiliate/referral-stats'; // Use actual endpoint
    const timestamp = Date.now();

    // Construct query and signature according to Bybit rules
    const queryString = `api_key=${apiKey}&timestamp=${timestamp}`;
    const signature = CryptoJS.HmacSHA256(queryString, apiSecret).toString(CryptoJS.enc.Hex);

    const affiliateTable = document.getElementById('affiliate-table');
    const affiliateList = document.getElementById('affiliate-list');
    const errorContainer = document.getElementById('error');

    try {
        const response = await fetch(`${apiUrl}?${queryString}&sign=${signature}`, {
            method: 'GET'
        });

        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);

        const data = await response.json();
        if (data.ret_code !== 0) throw new Error(data.ret_msg || 'API returned an error');

        const results = data.result?.list || [];
        if (results.length === 0) throw new Error('No affiliate data available');

        affiliateTable.classList.remove('hidden');
        errorContainer.classList.remove('show');
        affiliateList.innerHTML = '';

        results.slice(0, 10).forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><img src="${item.image || 'https://via.placeholder.com/100?text=Bybit'}" alt="${item.name || 'Offer Image'}" class="rounded"></td>
                <td class="font-medium">${item.name || item.referralCode || 'Unnamed Offer'}</td>
                <td>$${parseFloat(item.commission || item.value || 0).toFixed(2)}</td>
                <td>${item.description || item.campaignDescription || 'No description available'}</td>
            `;
            affiliateList.appendChild(row);
        });

    } catch (error) {
        console.error('Fetch Error:', error);
        errorContainer.textContent = `Failed to load affiliate data: ${error.message}. Please check the API endpoint or try again later.`;
        errorContainer.classList.add('show');
        affiliateTable.classList.add('hidden');
    }
}

document.addEventListener('DOMContentLoaded', fetchAffiliateData);
</script>
</body>
</html>
