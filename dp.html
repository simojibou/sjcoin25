<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SJ Printful Store</title>
<style>
body {font-family:Arial,sans-serif;max-width:1200px;margin:auto;padding:20px;}
h1{text-align:center}
#products{display:flex;flex-wrap:wrap;justify-content:space-around}
.product{border:1px solid #ccc;padding:10px;margin:10px;width:280px;text-align:center;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
.product img{max-width:100%;height:auto}
.error{color:red;text-align:center}
@media(max-width:600px){.product{width:100%}}
</style>
</head>
<body>
<h1>SJ Printful Store</h1>
<div id="products">Loading...</div>

<script>
const API_KEY = "ikq7abJTrAW7hZeMlod0xqaBmoA3mVlAa94YinMs"; // ضع مفتاح Printful الحقيقي هنا
const API_BASE = "https://api.printful.com";

async function loadProducts() {
  const container = document.getElementById("products");
  container.textContent = "Loading...";

  try {
    // ✅ طلب المنتجات من متجرك
    const res = await fetch(`${API_BASE}/store/products`, {
      headers: { "Authorization": `Bearer ${API_KEY}` }
    });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    if (!data.result || !Array.isArray(data.result)) throw new Error("Invalid data");

    container.innerHTML = "";
    for (const p of data.result) {
      // جلب تفاصيل كل منتج (للحصول على الصور والأسعار)
      const detailRes = await fetch(`${API_BASE}/store/products/${p.id}`, {
        headers: { "Authorization": `Bearer ${API_KEY}` }
      });
      const detail = await detailRes.json();
      const product = detail.result.sync_product;
      const variants = detail.result.sync_variants;

      const minPrice = Math.min(...variants.map(v => parseFloat(v.retail_price)));

      const div = document.createElement("div");
      div.className = "product";
      div.innerHTML = `
        <img src="${product.thumbnail_url || 'https://via.placeholder.com/150'}" alt="${product.name}">
        <h3>${product.name}</h3>
        <p>Starting from $${minPrice}</p>
      `;
      container.appendChild(div);
    }
  } catch (err) {
    console.error(err);
    container.innerHTML = `<p class="error">Failed to load products: ${err.message}</p>`;
  }
}

loadProducts();
</script>
</body>
</html>
