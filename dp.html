<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SJ Printful Store</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f9f9f9; }
    .container { max-width: 1200px; margin: auto; padding: 20px; }
    h1 { text-align: center; margin-bottom: 20px; }
    .products { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
    .product { background: #fff; padding: 15px; border-radius: 10px; width: 250px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); text-align: center; }
    .product img { width: 100%; border-radius: 10px; object-fit: cover; }
    .product h3 { margin: 10px 0 5px; font-size: 18px; }
    .product p { font-size: 14px; color: #444; }
    .cart { position: fixed; right: 20px; top: 20px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); width: 300px; max-height: 90vh; overflow-y: auto; }
    .cart h3 { margin-top: 0; }
    .cart ul { list-style: none; padding: 0; }
    .cart li { margin-bottom: 10px; }
    button { padding: 8px 12px; cursor: pointer; border: none; border-radius: 5px; background: #4caf50; color: #fff; transition: 0.3s; }
    button:hover { background: #43a047; }
  </style>
</head>
<body>

<div class="container">
  <h1>متجر SJ Printful</h1>
  <div class="products" id="products"></div>
</div>

<div class="cart">
  <h3>السلة</h3>
  <ul id="cartItems"></ul>
  <p>المجموع: $<span id="total">0</span></p>
  <button onclick="checkout()">إتمام الشراء</button>
</div>

<script>
  // ⚠️ ضع مفتاح Printful Store API هنا (للتجربة فقط)
  const API_KEY = 'ikq7abJTrAW7hZeMlod0xqaBmoA3mVlAa94YinMs';
  const productsContainer = document.getElementById('products');
  const cartItems = document.getElementById('cartItems');
  const totalEl = document.getElementById('total');
  let cart = [];

  // جلب المنتجات من متجر Printful
  async function fetchProducts() {
    try {
      const res = await fetch('https://api.printful.com/store/products', {
        headers: { 'Authorization': 'Bearer ' + API_KEY }
      });
      const data = await res.json();
      console.log(data); // لمراقبة البيانات في الـ Console
      displayProducts(data.result);
    } catch (err) {
      console.error('خطأ في جلب المنتجات:', err);
      productsContainer.innerHTML = '<p>تعذر تحميل المنتجات. تحقق من مفتاح API.</p>';
    }
  }

  // عرض المنتجات
  function displayProducts(products) {
    products.forEach(item => {
      const product = item.sync_product;
      const variant = item.sync_variants[0]; // أول متغير
      const price = variant?.retail_price || 'غير متوفر';
      const div = document.createElement('div');
      div.className = 'product';
      div.innerHTML = `
        <img src="${product.thumbnail_url}" alt="${product.name}">
        <h3>${product.name}</h3>
        <p>السعر: $${price}</p>
        <button onclick="addToCart('${product.name}', ${parseFloat(price) || 0})">أضف للسلة</button>
      `;
      productsContainer.appendChild(div);
    });
  }

  // إضافة للسلة
  function addToCart(name, price) {
    cart.push({ name, price });
    renderCart();
  }

  function renderCart() {
    cartItems.innerHTML = '';
    let total = 0;
    cart.forEach(item => {
      const li = document.createElement('li');
      li.textContent = `${item.name} - $${item.price}`;
      cartItems.appendChild(li);
      total += item.price;
    });
    totalEl.textContent = total.toFixed(2);
  }

  // مثال على إتمام الشراء
  function checkout() {
    alert('سيتم إرسال الطلب إلى Printful (مثال فقط). المجموع: $' + totalEl.textContent);
    // هنا يمكنك ربط API لإنشاء Order حقيقي في Printful
  }

  fetchProducts();
</script>

</body>
</html>
