<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SJ Label</title>
    <!-- Bootstrap CSS for good design -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS for label design -->
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Arial', sans-serif;
        }
        .header {
            background-color: #007bff;
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .artist-card {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin: 10px;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .form-section {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin: 20px auto;
            max-width: 600px;
        }
        .btn-primary {
            background-color: #007bff;
            border: none;
        }
        .btn-primary:hover {
            background-color: #0056b3;
        }
    </style>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js"></script>
</head>
<body>

    <div class="header">
        <h1>SJ Label</h1>
        <p>Welcome to SJ Label - Your Music Distribution Platform</p>
    </div>

    <div class="container">
        <!-- Login/Logout Section -->
        <div id="auth-section" class="text-center my-4">
            <button id="login-btn" class="btn btn-primary">Login with Google</button>
            <button id="logout-btn" class="btn btn-secondary d-none">Logout</button>
            <p id="user-info"></p>
        </div>

        <!-- Artists List Section -->
        <div id="artists-list" class="row">
            <h2 class="text-center">Our Artists</h2>
            <!-- Artists will be dynamically added here -->
        </div>

        <!-- Admin Section: Add Artist (only for admin) -->
        <div id="admin-section" class="form-section d-none">
            <h3>Add New Artist</h3>
            <form id="add-artist-form">
                <div class="mb-3">
                    <label for="artist-name" class="form-label">Artist Name</label>
                    <input type="text" class="form-control" id="artist-name" required>
                </div>
                <button type="submit" class="btn btn-primary">Add Artist</button>
            </form>
        </div>

        <!-- Submission Section: Submit Music -->
        <div id="submission-section" class="form-section d-none">
            <h3>Submit Your Music for Distribution</h3>
            <form id="submit-music-form">
                <div class="mb-3">
                    <label for="submit-artist-name" class="form-label">Artist Name</label>
                    <input type="text" class="form-control" id="submit-artist-name" required>
                </div>
                <div class="mb-3">
                    <label for="track-name" class="form-label">Track Name</label>
                    <input type="text" class="form-control" id="track-name" required>
                </div>
                <div class="mb-3">
                    <label for="cover-upload" class="form-label">Cover Art</label>
                    <input type="file" class="form-control" id="cover-upload" accept="image/*" required>
                </div>
                <div class="mb-3">
                    <label for="soundcloud-link" class="form-label">Private SoundCloud Link</label>
                    <input type="url" class="form-control" id="soundcloud-link" required>
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </div>
    </div>

    <script>
        // Your Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyD-sneIBO65i9uQIh3n_jw4MI7GQtjZfV8",
            authDomain: "sj-one.firebaseapp.com",
            databaseURL: "https://sj-one-default-rtdb.firebaseio.com",
            projectId: "sj-one",
            storageBucket: "sj-one.appspot.com",
            messagingSenderId: "426335553508",
            appId: "1:426335553508:web:248f76772f6f78419ca9f1",
            measurementId: "G-YQTVZQWXGB"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        const ADMIN_EMAIL = 'simo.jibou@gmail.com';

        // Elements
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const userInfo = document.getElementById('user-info');
        const artistsList = document.getElementById('artists-list');
        const adminSection = document.getElementById('admin-section');
        const submissionSection = document.getElementById('submission-section');
        const addArtistForm = document.getElementById('add-artist-form');
        const submitMusicForm = document.getElementById('submit-music-form');

        // Google Auth Provider
        const provider = new firebase.auth.GoogleAuthProvider();

        // Login with Google
        loginBtn.addEventListener('click', () => {
            auth.signInWithPopup(provider).catch(error => console.error(error));
        });

        // Logout
        logoutBtn.addEventListener('click', () => {
            auth.signOut().catch(error => console.error(error));
        });

        // Auth State Listener
        auth.onAuthStateChanged(user => {
            if (user) {
                loginBtn.classList.add('d-none');
                logoutBtn.classList.remove('d-none');
                userInfo.textContent = `Logged in as: ${user.email}`;
                submissionSection.classList.remove('d-none');

                if (user.email === ADMIN_EMAIL) {
                    adminSection.classList.remove('d-none');
                }
            } else {
                loginBtn.classList.remove('d-none');
                logoutBtn.classList.add('d-none');
                userInfo.textContent = '';
                adminSection.classList.add('d-none');
                submissionSection.classList.add('d-none');
            }
            loadArtists();
        });

        // Load Artists from Firestore
        function loadArtists() {
            artistsList.innerHTML = '<h2 class="text-center">Our Artists</h2>'; // Reset
            db.collection('artists').get().then(snapshot => {
                snapshot.forEach(doc => {
                    const artist = doc.data();
                    const card = document.createElement('div');
                    card.className = 'col-md-4 artist-card';
                    card.innerHTML = `<h5>${artist.name}</h5>`;
                    artistsList.appendChild(card);
                });
            }).catch(error => console.error(error));
        }

        // Add Artist (Admin only)
        addArtistForm.addEventListener('submit', e => {
            e.preventDefault();
            const name = document.getElementById('artist-name').value;
            db.collection('artists').add({ name }).then(() => {
                alert('Artist added!');
                addArtistForm.reset();
                loadArtists();
            }).catch(error => console.error(error));
        });

        // Submit Music
        submitMusicForm.addEventListener('submit', e => {
            e.preventDefault();
            const artistName = document.getElementById('submit-artist-name').value;
            const trackName = document.getElementById('track-name').value;
            const soundcloudLink = document.getElementById('soundcloud-link').value;
            const coverFile = document.getElementById('cover-upload').files[0];

            // Upload cover to Storage
            const storageRef = storage.ref(`covers/${coverFile.name}`);
            storageRef.put(coverFile).then(snapshot => {
                return snapshot.ref.getDownloadURL();
            }).then(url => {
                // Save submission to Firestore
                return db.collection('submissions').add({
                    artistName,
                    trackName,
                    coverUrl: url,
                    soundcloudLink,
                    submittedBy: auth.currentUser.email,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
            }).then(() => {
                alert('Submission successful!');
                submitMusicForm.reset();
            }).catch(error => console.error(error));
        });
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
