
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SJ X N41 music - Artist</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Custom CSS (Netflix-inspired) -->
    <style>
        :root{
            --color-red: #e50914; /* Netflix red */
            --color-white: #ffffff;
            --color-dark: #141414; /* Netflix primary dark */
            --color-dark-light: #221f1f; /* Slightly lighter dark for accents */
            --color-grey: #8c8c8c; /* For secondary text */
            --space-unit: 16px; /* Larger spacing for Netflix feel */
            --space-1: calc(var(--space-unit) * 1);
            --space-2: calc(var(--space-unit) * 2);
            --space-3: calc(var(--space-unit) * 3);
            --instagram-blue: #0095f6; /* Instagram verified blue */
        }
        body{
            background: var(--color-dark);
            color: var(--color-white);
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; /* Netflix-like font stack */
            margin: 0;
            padding-top: 56px; /* Padding for fixed navbar */
            overflow-x: hidden;
        }
        .navbar{
            background-color: var(--color-dark) !important;
        }
        .navbar-brand{
            color: var(--color-red);
            font-weight: bold;
            font-size: 1.5rem;
        }
        .navbar-brand:hover{
            color: var(--color-red);
        }
        .nav-link{
            color: var(--color-white) !important;
            font-weight: 500;
        }
        .nav-link:hover{
            color: var(--color-grey) !important;
        }
        .nav-link.active{
            color: var(--color-white) !important;
            font-weight: bold;
        }
        .artist-hero{
            position: relative;
            height: 70vh; /* Taller hero for dramatic Netflix effect */
            width: 100%;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: flex-end; /* Align content to bottom like Netflix banners */
            justify-content: flex-start;
            text-align: left;
            margin-bottom: var(--space-3);
            padding: var(--space-3) var(--space-3) var(--space-2);
        }
        .artist-hero::before{
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(20,20,20,0), rgba(20,20,20,1)); /* Netflix fade to black */
            z-index: 1;
        }
        .artist-hero-content{
            position: relative;
            z-index: 2;
            max-width: 50%;
        }
        .artist-hero h1{
            font-size: 4rem; /* Larger, bold titles */
            font-weight: 700;
            letter-spacing: -1px;
            color: var(--color-white);
            margin-bottom: var(--space-1);
            text-shadow: 0 2px 4px rgba(0,0,0,0.5); /* Subtle shadow for readability */
        }
        .artist-hero .social-links{
            font-size: 1.5rem;
        }
        .artist-bio{
            max-width: 90%;
            margin: 0 auto;
            padding: var(--space-2);
            background: var(--color-dark-light);
            border-radius: 4px; /* Minimal rounding like Netflix cards */
        }
        .artist-bio h3{
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: var(--space-1);
        }
        .artist-bio p{
            font-size: 1rem;
            line-height: 1.6;
            color: var(--color-grey); /* Secondary text color */
        }
        .artist-stats{
            max-width: 90%;
            margin: var(--space-3) auto;
            padding: var(--space-2);
            background: var(--color-dark-light);
            border-radius: 4px;
        }
        .artist-stats h3{
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: var(--space-1);
        }
        .artist-stats p{
            font-size: 1rem;
            color: var(--color-grey);
        }
        .admin-actions{
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 3;
        }
        .admin-actions button{
            background: none;
            border: none;
            color: var(--color-white);
            margin-left: 10px;
            cursor: pointer;
            font-size: 1.5rem;
        }
        .admin-actions button:hover{
            color: var(--color-red);
        }
        .social-links a{
            color: var(--color-grey);
            margin-right: 12px;
            font-size: 1.5rem;
            transition: color .3s;
        }
        .social-links a:hover{
            color: var(--color-red);
        }
        .ad-container-wrapper{
            display: flex;
            justify-content: center;
            margin: var(--space-2) auto;
        }
        #ad-container{
            width: 728px; /* Wider ad for Netflix-like layout */
            height: 90px;
            max-width: 100%;
        }
        .btn-secondary{
            background-color: var(--color-red);
            border: none;
            font-weight: 600;
            padding: 10px 20px;
            border-radius: 4px;
        }
        .btn-secondary:hover{
            background-color: #b20710; /* Darker red on hover */
        }
        /* Profile image style */
        #profile-link img {
            object-fit: cover;
        }
        /* Search results style - Netflix-like cards */
        .search-result-card {
            transition: transform 0.2s;
        }
        .search-result-card:hover {
            transform: scale(1.05);
        }
        .search-result-card img {
            aspect-ratio: 2/3; /* Poster-like aspect ratio */
            object-fit: cover;
        }
        .search-result-card .card-body {
            text-align: center;
        }
        /* Products section - Netflix-style horizontal scroll */
        .products-section .overflow-auto,
        .tracks-section .overflow-auto {
            overflow-x: auto;
            overflow-y: hidden;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE/Edge */
        }
        .products-section .overflow-auto::-webkit-scrollbar,
        .tracks-section .overflow-auto::-webkit-scrollbar {
            display: none; /* Chrome/Safari */
        }
        .products-section .product-card,
        .tracks-section .track-card {
            min-width: 150px;
            max-width: 200px;
            flex: 0 0 auto;
        }
        /* Verified badge style like Instagram */
        .verified-badge {
            color: var(--instagram-blue);
            font-size: 0.8em;
            vertical-align: middle;
            margin-left: 5px;
        }
        /* Mobile tweaks */
        @media (max-width: 768px){
            .artist-hero{
                height: 50vh;
                align-items: center;
                justify-content: center;
                text-align: center;
            }
            .artist-hero-content{
                max-width: 90%;
            }
            .artist-hero h1{
                font-size: 2.5rem;
            }
            .artist-bio{
                max-width: 95%;
            }
            #ad-container{
                width: 100%;
                height: auto;
            }
        }
        @media (max-width: 576px){
            .artist-hero h1{
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Netflix-inspired Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="https://simojibou.github.io/sjcoin25/sjlabel5.html">SJ X N41</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="https://simojibou.github.io/sjcoin25/sjlabel5.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://simojibou.github.io/sjcoin25/sjstore.html">SJSTORE</a>
                    </li>
                  
                   
                </ul>
                <ul class="navbar-nav mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#searchModal"><i class="bi bi-search"></i></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="bi bi-bell"></i></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="profile-link" href="#"><i class="bi bi-person-circle"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Search Modal -->
    <div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title" id="searchModalLabel">Search Artists</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="searchInput" class="form-control bg-dark text-white" placeholder="Search for artists...">
                    <select id="searchType" class="form-select bg-dark text-white mt-2">
                        <option value="local">Local Artists</option>
                        <option value="spotify">Spotify Artists</option>
                        <option value="kick">Kick Gamers</option>
                    </select>
                    <div id="searchResults" class="row mt-3 gy-3"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edit Artist</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <div class="mb-3">
                            <label for="name" class="form-label">Name</label>
                            <input type="text" class="form-control bg-dark text-white" id="name" required>
                        </div>
                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control bg-dark text-white" id="description" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="imageUrl" class="form-label">Image URL (current)</label>
                            <input type="url" class="form-control bg-dark text-white" id="imageUrl">
                        </div>
                        <div class="mb-3">
                            <label for="imageFile" class="form-label">Upload New Image from Device (optional)</label>
                            <input type="file" class="form-control bg-dark text-white" id="imageFile" accept="image/*">
                        </div>
                        <div class="mb-3">
                            <label for="instagram" class="form-label">Instagram</label>
                            <input type="url" class="form-control bg-dark text-white" id="instagram">
                        </div>
                        <div class="mb-3">
                            <label for="spotify" class="form-label">Spotify</label>
                            <input type="url" class="form-control bg-dark text-white" id="spotify">
                        </div>
                        <div class="mb-3">
                            <label for="kick" class="form-label">Kick</label>
                            <input type="url" class="form-control bg-dark text-white" id="kick">
                        </div>
                        <div class="mb-3">
                            <label for="tiktok" class="form-label">TikTok</label>
                            <input type="url" class="form-control bg-dark text-white" id="tiktok">
                        </div>
                        <div class="mb-3">
                            <label for="youtube" class="form-label">YouTube</label>
                            <input type="url" class="form-control bg-dark text-white" id="youtube">
                        </div>
                        <div class="mb-3">
                            <label for="googlePlay" class="form-label">Google Play</label>
                            <input type="url" class="form-control bg-dark text-white" id="googlePlay">
                        </div>
                        <div class="mb-3">
                            <label for="appleMusic" class="form-label">Apple Music</label>
                            <input type="url" class="form-control bg-dark text-white" id="appleMusic">
                        </div>
                        <div class="mb-3">
                            <label for="personalWebsite" class="form-label">Personal Website</label>
                            <input type="url" class="form-control bg-dark text-white" id="personalWebsite">
                        </div>
                        <div class="mb-3">
                            <label for="x" class="form-label">X (Twitter)</label>
                            <input type="url" class="form-control bg-dark text-white" id="x">
                        </div>
                        <div class="mb-3">
                            <label for="snapchat" class="form-label">Snapchat</label>
                            <input type="url" class="form-control bg-dark text-white" id="snapchat">
                        </div>
                        <div class="mb-3">
                            <label for="whatsapp" class="form-label">WhatsApp</label>
                            <input type="url" class="form-control bg-dark text-white" id="whatsapp">
                        </div>
                        <div class="mb-3">
                            <label for="facebook" class="form-label">Facebook</label>
                            <input type="url" class="form-control bg-dark text-white" id="facebook">
                        </div>
                        <div class="mb-3">
                            <label for="soundcloud" class="form-label">SoundCloud</label>
                            <input type="url" class="form-control bg-dark text-white" id="soundcloud">
                        </div>
                        <div class="mb-3">
                            <label for="appstore" class="form-label">App Store</label>
                            <input type="url" class="form-control bg-dark text-white" id="appstore">
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="verified">
                            <label class="form-check-label" for="verified">Verified Account</label>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Add Product Modal -->
    <div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title" id="addProductModalLabel">Add Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addProductForm">
                        <div class="mb-3">
                            <label for="productTitle" class="form-label">Title</label>
                            <input type="text" class="form-control bg-dark text-white" id="productTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="productDesc" class="form-label">Short Description</label>
                            <textarea class="form-control bg-dark text-white" id="productDesc" rows="2"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="productPrice" class="form-label">Price ($)</label>
                            <input type="number" class="form-control bg-dark text-white" id="productPrice" step="0.01" required>
                        </div>
                        <div class="mb-3">
                            <label for="productPic" class="form-label">Upload Picture from Device</label>
                            <input type="file" class="form-control bg-dark text-white" id="productPic" accept="image/*" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Product</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Share Profile Modal -->
    <div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title" id="shareModalLabel">Share Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <div id="qr-code" class="d-inline-block mb-3"></div>
                    <p>Scan the QR code to share this profile</p>
                    <input type="text" id="profile-link-input" class="form-control bg-dark text-white mt-3" readonly>
                    <button class="btn btn-secondary mt-2" onclick="copyLink()">Copy Link</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Main Content -->
    <div id="artist-container" class="container-fluid p-0"> <!-- Full-width for Netflix feel -->
        <!-- Artist content will be injected here -->
    </div>
    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Firebase SDKs (Modular) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, increment, collection, query, where, orderBy, startAt, endAt, getDocs, deleteDoc, addDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-storage.js";
        const firebaseConfig = {
            apiKey: "AIzaSyD-sneIBO65i9uQIh3n_jw4MI7GQtjZfV8",
            authDomain: "sj-one.firebaseapp.com",
            databaseURL: "https://sj-one-default-rtdb.firebaseio.com",
            projectId: "sj-one",
            storageBucket: "sj-one.appspot.com",
            messagingSenderId: "426335553508",
            appId: "1:426335553508:web:248f76772f6f78419ca9f1",
            measurementId: "G-YQTVZQWXGB"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);
        const ADMIN_EMAIL = 'simo.jibou@gmail.com';
        let currentUser = null;
        let artistId = null;
        let spotifyId = null;
        let kickId = null;
        let currentArtist = null;
        let currentBio = '';
        let currentSocial = {};
        // Spotify Credentials - Replace with your own from developer.spotify.com
        // WARNING: Exposing clientSecret in client-side code is insecure for production use. 
        // Use a backend server to handle token requests in a real app.
        const spotifyClientId = '2e6b3a5e190c4e918bf4650bceac9af4';
        const spotifyClientSecret = '4d0370f7ea0148adb056c22fddd03341';
        // ---------- Helper ----------
        function getQueryParam(name) {
            return new URLSearchParams(window.location.search).get(name);
        }
        // ---------- Login with Google ----------
        async function loginWithGoogle() {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                console.error('Login error:', error);
            }
        }
        // ---------- Update Profile UI ----------
        function updateProfileUI(user) {
            const profileLink = document.getElementById('profile-link');
            if (user) {
                profileLink.innerHTML = `<img src="${user.photoURL || 'https://via.placeholder.com/32?text=U'}" class="rounded-circle" width="32" height="32" alt="Profile">`;
                profileLink.onclick = null; // Could add profile dropdown later
            } else {
                profileLink.innerHTML = `<i class="bi bi-person-circle"></i>`;
                profileLink.onclick = loginWithGoogle;
            }
        }
        // ---------- Local Search Artists ----------
        async function searchLocalArtists(searchTerm) {
            const resultsContainer = document.getElementById('searchResults');
            resultsContainer.innerHTML = '';
            if (!searchTerm) return;
            const lowerTerm = searchTerm.toLowerCase();
            const capTerm = searchTerm.charAt(0).toUpperCase() + searchTerm.slice(1).toLowerCase();
            const queries = [];
            if (lowerTerm !== capTerm) {
                queries.push(query(collection(db, 'artists'), orderBy('name'), startAt(capTerm), endAt(capTerm + '\uf8ff')));
            }
            queries.push(query(collection(db, 'artists'), orderBy('name'), startAt(lowerTerm), endAt(lowerTerm + '\uf8ff')));
            let artists = new Map(); // To avoid duplicates
            try {
                for (const q of queries) {
                    const snapshot = await getDocs(q);
                    snapshot.forEach(doc => {
                        const artist = doc.data();
                        const id = doc.id;
                        if (!artists.has(id)) {
                            artists.set(id, {id, artist});
                        }
                    });
                }
                if (artists.size === 0) {
                    resultsContainer.innerHTML = '<p class="text-center text-muted">No artists found.</p>';
                    return;
                }
                artists.forEach(({id, artist}) => {
                    const verifiedBadge = artist.verified ? '<i class="bi bi-check-circle-fill verified-badge"></i>' : '';
                    const card = `
                        <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                            <a href="artistpage.html?artist=${id}" class="text-decoration-none">
                                <div class="card bg-dark border-0 search-result-card">
                                    <img src="${artist.imageUrl || 'https://via.placeholder.com/200x300/141414/ffffff?text=Artist'}" class="card-img-top" alt="${artist.name}">
                                    <div class="card-body p-2">
                                        <h6 class="card-title text-white">${artist.name}${verifiedBadge}</h6>
                                    </div>
                                </div>
                            </a>
                        </div>
                    `;
                    resultsContainer.innerHTML += card;
                });
            } catch (error) {
                console.error('Search error:', error);
                resultsContainer.innerHTML = '<p class="text-center text-danger">Error searching artists.</p>';
            }
        }
        // ---------- Spotify Search Artists ----------
        async function searchSpotifyArtists(searchTerm) {
            const resultsContainer = document.getElementById('searchResults');
            resultsContainer.innerHTML = '';
            if (!searchTerm) return;
            try {
                const token = await getSpotifyToken();
                const response = await fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(searchTerm)}&type=artist&limit=20`, {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });
                if (!response.ok) {
                    throw new Error('Failed to search Spotify artists');
                }
                const data = await response.json();
                const artists = data.artists.items;
                if (artists.length === 0) {
                    resultsContainer.innerHTML = '<p class="text-center text-muted">No artists found on Spotify.</p>';
                    return;
                }
                artists.forEach(artist => {
                    const verifiedBadge = ''; // Spotify doesn't provide verified in search, can add logic if needed
                    const card = `
                        <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                            <a href="artistpage.html?spotify=${artist.id}" class="text-decoration-none">
                                <div class="card bg-dark border-0 search-result-card">
                                    <img src="${artist.images[0]?.url || 'https://via.placeholder.com/200x300/141414/ffffff?text=Artist'}" class="card-img-top" alt="${artist.name}">
                                    <div class="card-body p-2">
                                        <h6 class="card-title text-white">${artist.name}${verifiedBadge}</h6>
                                    </div>
                                </div>
                            </a>
                        </div>
                    `;
                    resultsContainer.innerHTML += card;
                });
            } catch (error) {
                console.error('Spotify search error:', error);
                resultsContainer.innerHTML = '<p class="text-center text-danger">Error searching Spotify artists.</p>';
            }
        }
        // ---------- Kick Search Gamers ----------
        async function searchKickGamers(searchTerm) {
            const resultsContainer = document.getElementById('searchResults');
            resultsContainer.innerHTML = '';
            if (!searchTerm) return;
            try {
                const response = await fetch(`https://kick.com/api/search?q=${encodeURIComponent(searchTerm)}`);
                if (!response.ok) {
                    throw new Error('Failed to search Kick channels');
                }
                const data = await response.json();
                const channels = data.channels || []; // Assuming response structure
                if (channels.length === 0) {
                    resultsContainer.innerHTML = '<p class="text-center text-muted">No gamers found on Kick.</p>';
                    return;
                }
                channels.forEach(channel => {
                    const verifiedBadge = channel.verified ? '<i class="bi bi-check-circle-fill verified-badge"></i>' : '';
                    const image = channel.user.profilepic || 'https://via.placeholder.com/200x300/141414/ffffff?text=Gamer';
                    const slug = channel.slug;
                    const name = channel.user.username;
                    const card = `
                        <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                            <a href="artistpage.html?kick=${slug}" class="text-decoration-none">
                                <div class="card bg-dark border-0 search-result-card">
                                    <img src="${image}" class="card-img-top" alt="${name}">
                                    <div class="card-body p-2">
                                        <h6 class="card-title text-white">${name}${verifiedBadge}</h6>
                                    </div>
                                </div>
                            </a>
                        </div>
                    `;
                    resultsContainer.innerHTML += card;
                });
            } catch (error) {
                console.error('Kick search error:', error);
                resultsContainer.innerHTML = '<p class="text-center text-danger">Error searching Kick gamers.</p>';
            }
        }
        // ---------- Load Products ----------
        async function loadProducts(id) {
            const productsContainer = document.getElementById('products-row');
            if (!productsContainer) return;
            productsContainer.innerHTML = '';
            const q = query(collection(db, `artists/${id}/products`));
            try {
                const snapshot = await getDocs(q);
                if (snapshot.empty) {
                    productsContainer.innerHTML = '<p class="text-center text-muted">No products available.</p>';
                    return;
                }
                snapshot.forEach(doc => {
                    const prod = doc.data();
                    const card = `
                        <div class="product-card search-result-card">
                            <div class="card bg-dark border-0">
                                <img src="${prod.picUrl || 'https://via.placeholder.com/200x300/141414/ffffff?text=Product'}" class="card-img-top" alt="${prod.title}">
                                <div class="card-body p-2">
                                    <h6 class="card-title text-white">${prod.title}</h6>
                                    <p class="text-muted small">${prod.description || ''}</p>
                                    <p class="text-white fw-bold">$${prod.price.toFixed(2)}</p>
                                </div>
                            </div>
                        </div>
                    `;
                    productsContainer.innerHTML += card;
                });
            } catch (error) {
                console.error('Load products error:', error);
            }
        }
        // ---------- Spotify Helper Functions ----------
        function getSpotifyArtistId(url) {
            if (!url) return null;
            const match = url.match(/artist\/([a-zA-Z0-9]+)/);
            return match ? match[1] : null;
        }
        async function getSpotifyToken() {
            const response = await fetch('https://accounts.spotify.com/api/token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'Authorization': 'Basic ' + btoa(spotifyClientId + ':' + spotifyClientSecret)
                },
                body: 'grant_type=client_credentials'
            });
            if (!response.ok) {
                throw new Error('Failed to get Spotify token');
            }
            const data = await response.json();
            return data.access_token;
        }
        async function getArtistAlbums(spotifyArtistId, token) {
            let albums = [];
            let url = `https://api.spotify.com/v1/artists/${spotifyArtistId}/albums?include_groups=album,single&market=US&limit=50`;
            while (url) {
                const response = await fetch(url, {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });
                if (!response.ok) {
                    throw new Error('Failed to fetch albums');
                }
                const data = await response.json();
                albums = albums.concat(data.items);
                url = data.next;
            }
            return albums;
        }
        async function getAlbumTracks(albumId, token) {
            let tracks = [];
            let url = `https://api.spotify.com/v1/albums/${albumId}/tracks?limit=50`;
            while (url) {
                const response = await fetch(url, {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });
                if (!response.ok) {
                    throw new Error('Failed to fetch tracks');
                }
                const data = await response.json();
                tracks = tracks.concat(data.items);
                url = data.next;
            }
            return tracks;
        }
        async function getAllArtistTracks(spotifyArtistId, token) {
            const albums = await getArtistAlbums(spotifyArtistId, token);
            let allTracks = [];
            for (const album of albums) {
                const tracks = await getAlbumTracks(album.id, token);
                tracks.forEach(track => {
                    track.album = {
                        name: album.name,
                        images: album.images
                    };
                });
                allTracks = allTracks.concat(tracks);
            }
            // Deduplicate by track ID
            const uniqueTracks = new Map();
            allTracks.forEach(track => {
                if (!uniqueTracks.has(track.id)) {
                    uniqueTracks.set(track.id, track);
                }
            });
            return Array.from(uniqueTracks.values());
        }
        // ---------- Wikipedia Helpers ----------
        async function getWikipediaBio(name) {
            try {
                const response = await fetch(`https://en.wikipedia.org/w/api.php?action=query&format=json&prop=extracts&exintro&explaintext&redirects=1&exsentences=10&titles=${encodeURIComponent(name)}&origin=*`);
                const data = await response.json();
                const page = Object.values(data.query.pages)[0];
                return page.extract || artist.genres.join(', ') || 'No biography available.';
            } catch (error) {
                console.error('Wikipedia bio error:', error);
                return artist.genres.join(', ') || 'Error fetching biography.';
            }
        }
        async function getWikipediaSocial(name) {
            try {
                const response = await fetch(`https://en.wikipedia.org/w/api.php?action=query&format=json&prop=extlinks&ellimit=max&titles=${encodeURIComponent(name)}&origin=*`);
                const data = await response.json();
                const page = Object.values(data.query.pages)[0];
                const extlinks = page.extlinks || [];
                const social = {};
                extlinks.forEach(link => {
                    const url = link.url;
                    if (url.includes('instagram.com')) social.instagram = url;
                    if (url.includes('twitter.com') || url.includes('x.com')) social.x = url;
                    if (url.includes('facebook.com')) social.facebook = url;
                    if (url.includes('tiktok.com')) social.tiktok = url;
                    if (url.includes('youtube.com')) social.youtube = url;
                    if (url.includes('soundcloud.com')) social.soundcloud = url;
                    // Add more if needed
                });
                return social;
            } catch (error) {
                console.error('Wikipedia social error:', error);
                return {};
            }
        }
        // ---------- Load Tracks from Spotify ----------
        async function loadTracks(spotifyArtistId) {
            const tracksContainer = document.getElementById('tracks-row');
            if (!tracksContainer) return;
            tracksContainer.innerHTML = '';
            if (!spotifyArtistId) {
                tracksContainer.innerHTML = '<p class="text-center text-muted">No Spotify profile linked.</p>';
                return;
            }
            try {
                const token = await getSpotifyToken();
                const tracks = await getAllArtistTracks(spotifyArtistId, token);
                if (tracks.length === 0) {
                    tracksContainer.innerHTML = '<p class="text-center text-muted">No tracks found on Spotify.</p>';
                    return;
                }
                tracks.forEach(track => {
                    const imageUrl = track.album.images[0]?.url || 'https://via.placeholder.com/200x200/141414/ffffff?text=Track';
                    const card = `
                        <div class="track-card search-result-card">
                            <div class="card bg-dark border-0">
                                <img src="${imageUrl}" class="card-img-top" alt="${track.name}">
                                <div class="card-body p-2">
                                    <h6 class="card-title text-white">${track.name}</h6>
                                    <p class="text-muted small">${track.album.name}</p>
                                    <a href="${track.external_urls.spotify}" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-secondary">Listen on Spotify</a>
                                </div>
                            </div>
                        </div>
                    `;
                    tracksContainer.innerHTML += card;
                });
            } catch (error) {
                console.error('Spotify fetch error:', error);
                tracksContainer.innerHTML = '<p class="text-center text-danger">Error loading tracks from Spotify. Check console for details.</p>';
            }
        }
        // ---------- Load Clips from Kick ----------
        async function loadKickClips(slug) {
            const tracksContainer = document.getElementById('tracks-row');
            if (!tracksContainer) return;
            tracksContainer.innerHTML = '';
            try {
                const response = await fetch(`https://kick.com/api/v2/channels/${slug}/clips?limit=20`);
                if (!response.ok) {
                    throw new Error('Failed to fetch clips');
                }
                const data = await response.json();
                const clips = data.clips || data.data || []; // Assuming structure
                if (clips.length === 0) {
                    tracksContainer.innerHTML = '<p class="text-center text-muted">No clips found on Kick.</p>';
                    return;
                }
                clips.forEach(clip => {
                    const imageUrl = clip.thumbnail || clip.thumbnail_url || 'https://via.placeholder.com/200x200/141414/ffffff?text=Clip';
                    const card = `
                        <div class="track-card search-result-card">
                            <div class="card bg-dark border-0">
                                <img src="${imageUrl}" class="card-img-top" alt="${clip.title}">
                                <div class="card-body p-2">
                                    <h6 class="card-title text-white">${clip.title}</h6>
                                    <p class="text-muted small">${clip.category ? clip.category.name : ''}</p>
                                    <a href="${clip.url || clip.video_url}" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-secondary">Watch on Kick</a>
                                </div>
                            </div>
                        </div>
                    `;
                    tracksContainer.innerHTML += card;
                });
            } catch (error) {
                console.error('Kick clips fetch error:', error);
                tracksContainer.innerHTML = '<p class="text-center text-danger">Error loading clips from Kick.</p>';
            }
        }
        // ---------- Load Local Artist ----------
        async function loadLocalArtist(id) {
            const artistRef = doc(db, 'artists', id);
            const snap = await getDoc(artistRef);
            if (!snap.exists()) {
                document.getElementById('artist-container').innerHTML = '<h2 class="text-center">Artist not found</h2>';
                return;
            }
            let artist = snap.data();
            // Attempt to increment views
            try {
                await updateDoc(artistRef, { views: increment(1) });
                const updatedSnap = await getDoc(artistRef);
                artist = updatedSnap.data();
            } catch (e) {
                console.error('Failed to increment views:', e);
            }
            currentArtist = artist;
            const isAdmin = currentUser && currentUser.email === ADMIN_EMAIL;
            const adminActions = isAdmin ? `<div class="admin-actions"><button onclick="editArtist('${id}')" title="Edit"><i class="bi bi-pencil"></i></button><button onclick="deleteArtist('${id}')" title="Delete"><i class="bi bi-trash"></i></button></div>` : '';
            const verifiedBadge = artist.verified ? '<i class="bi bi-check-circle-fill verified-badge"></i>' : '';
            const artistStats = `<div class="artist-stats"><h3>Artist Stats</h3><p>Total Views: ${artist.views || 0}</p>${isAdmin ? `<p>Earnings: $${((artist.views || 0) / 1000).toFixed(2)}</p>` : ''}</div>`;
            const html = `
                <div class="artist-hero" style="background-image: url('${artist.imageUrl || 'https://via.placeholder.com/1920x1080/141414/ffffff?text=Artist+Photo'}');">
                    <div class="artist-hero-content">
                        ${adminActions}
                        <h1>${artist.name}${verifiedBadge}</h1>
                        <div class="social-links">
                            ${artist.instagram ? `<a href="${artist.instagram}" target="_blank" rel="noopener noreferrer"><i class="bi bi-instagram"></i></a>` : ''}
                            ${artist.spotify ? `<a href="${artist.spotify}" target="_blank" rel="noopener noreferrer"><i class="bi bi-spotify"></i></a>` : ''}
                            ${artist.kick ? `<a href="${artist.kick}" target="_blank" rel="noopener noreferrer"><i class="bi bi-joystick"></i></a>` : ''}
                            ${artist.tiktok ? `<a href="${artist.tiktok}" target="_blank" rel="noopener noreferrer"><i class="bi bi-tiktok"></i></a>` : ''}
                            ${artist.youtube ? `<a href="${artist.youtube}" target="_blank" rel="noopener noreferrer"><i class="bi bi-youtube"></i></a>` : ''}
                            ${artist.googlePlay ? `<a href="${artist.googlePlay}" target="_blank" rel="noopener noreferrer"><i class="bi bi-google"></i></a>` : ''}
                            ${artist.appleMusic ? `<a href="${artist.appleMusic}" target="_blank" rel="noopener noreferrer"><i class="bi bi-apple"></i></a>` : ''}
                            ${artist.personalWebsite ? `<a href="${artist.personalWebsite}" target="_blank" rel="noopener noreferrer"><i class="bi bi-globe"></i></a>` : ''}
                            ${artist.x ? `<a href="${artist.x}" target="_blank" rel="noopener noreferrer"><i class="bi bi-twitter"></i></a>` : ''}
                            ${artist.snapchat ? `<a href="${artist.snapchat}" target="_blank" rel="noopener noreferrer"><i class="bi bi-snapchat"></i></a>` : ''}
                            ${artist.whatsapp ? `<a href="${artist.whatsapp}" target="_blank" rel="noopener noreferrer"><i class="bi bi-whatsapp"></i></a>` : ''}
                            ${artist.facebook ? `<a href="${artist.facebook}" target="_blank" rel="noopener noreferrer"><i class="bi bi-facebook"></i></a>` : ''}
                            ${artist.soundcloud ? `<a href="${artist.soundcloud}" target="_blank" rel="noopener noreferrer"><i class="bi bi-soundwave"></i></a>` : ''}
                            ${artist.appstore ? `<a href="${artist.appstore}" target="_blank" rel="noopener noreferrer"><i class="bi bi-app"></i></a>` : ''}
                            <a href="#" data-bs-toggle="modal" data-bs-target="#shareModal"><i class="bi bi-qr-code-scan"></i></a>
                        </div>
                    </div>
                </div>
                <div class="ad-container-wrapper"><div id="ad-container"></div></div>
                <div class="container">
                    <div class="artist-bio">
                        <h3>Biography</h3>
                        <p>${artist.description || 'Emerging talent in the music scene.'}</p>
                    </div>
                    ${artistStats}
                    <div class="products-section mt-4">
                        <h3 id="products-header">Products</h3>
                        <div id="products-row" class="d-flex flex-nowrap overflow-auto gap-3 pb-3"></div>
                    </div>
                    <div class="tracks-section mt-4">
                        <h3 id="tracks-header">Tracks</h3>
                        <div id="tracks-row" class="d-flex flex-nowrap overflow-auto gap-3 pb-3"></div>
                    </div>
                </div>
            `;
            document.getElementById('artist-container').innerHTML = html;
            await loadProducts(id);
            const spotifyArtistId = getSpotifyArtistId(artist.spotify);
            await loadTracks(spotifyArtistId);
            if (isAdmin) {
                const header = document.getElementById('products-header');
                const addBtn = document.createElement('button');
                addBtn.className = 'btn btn-sm btn-secondary ms-2';
                addBtn.textContent = 'Add Product';
                addBtn.onclick = () => {
                    const modal = new bootstrap.Modal(document.getElementById('addProductModal'));
                    modal.show();
                };
                header.appendChild(addBtn);
            }
        }
        // ---------- Load Spotify Artist ----------
        async function loadSpotifyArtist(id) {
            try {
                const token = await getSpotifyToken();
                const response = await fetch(`https://api.spotify.com/v1/artists/${id}`, {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });
                if (!response.ok) {
                    throw new Error('Failed to fetch Spotify artist');
                }
                const artist = await response.json();
                currentArtist = artist; // For edit? But no edit for Spotify
                currentBio = await getWikipediaBio(artist.name);
                currentSocial = await getWikipediaSocial(artist.name);
                const isAdmin = currentUser && currentUser.email === ADMIN_EMAIL;
                const adminActions = isAdmin ? `<div class="admin-actions"><button onclick="importArtist()" title="Import"><i class="bi bi-plus"></i></button></div>` : '';
                const verifiedBadge = (currentBio !== artist.genres.join(', ')) ? '<i class="bi bi-check-circle-fill verified-badge"></i>' : '';
                const artistStats = `<div class="artist-stats"><h3>Artist Stats</h3><p>Followers: ${artist.followers.total}</p><p>Popularity: ${artist.popularity}</p></div>`;
                const html = `
                    <div class="artist-hero" style="background-image: url('${artist.images[0]?.url || 'https://via.placeholder.com/1920x1080/141414/ffffff?text=Artist+Photo'}');">
                        <div class="artist-hero-content">
                            ${adminActions}
                            <h1>${artist.name}${verifiedBadge}</h1>
                            <div class="social-links">
                                <a href="${artist.external_urls.spotify}" target="_blank" rel="noopener noreferrer"><i class="bi bi-spotify"></i></a>
                                ${currentSocial.instagram ? `<a href="${currentSocial.instagram}" target="_blank" rel="noopener noreferrer"><i class="bi bi-instagram"></i></a>` : ''}
                                ${currentSocial.x ? `<a href="${currentSocial.x}" target="_blank" rel="noopener noreferrer"><i class="bi bi-twitter"></i></a>` : ''}
                                ${currentSocial.facebook ? `<a href="${currentSocial.facebook}" target="_blank" rel="noopener noreferrer"><i class="bi bi-facebook"></i></a>` : ''}
                                ${currentSocial.tiktok ? `<a href="${currentSocial.tiktok}" target="_blank" rel="noopener noreferrer"><i class="bi bi-tiktok"></i></a>` : ''}
                                ${currentSocial.youtube ? `<a href="${currentSocial.youtube}" target="_blank" rel="noopener noreferrer"><i class="bi bi-youtube"></i></a>` : ''}
                                ${currentSocial.soundcloud ? `<a href="${currentSocial.soundcloud}" target="_blank" rel="noopener noreferrer"><i class="bi bi-soundwave"></i></a>` : ''}
                                <a href="#" data-bs-toggle="modal" data-bs-target="#shareModal"><i class="bi bi-qr-code-scan"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="ad-container-wrapper"><div id="ad-container"></div></div>
                    <div class="container">
                        <div class="artist-bio">
                            <h3>Biography</h3>
                            <p>${currentBio}</p>
                        </div>
                        ${artistStats}
                        <div class="products-section mt-4" style="display: none;"></div> <!-- No products -->
                        <div class="tracks-section mt-4">
                            <h3 id="tracks-header">Tracks</h3>
                            <div id="tracks-row" class="d-flex flex-nowrap overflow-auto gap-3 pb-3"></div>
                        </div>
                    </div>
                `;
                document.getElementById('artist-container').innerHTML = html;
                await loadTracks(id);
            } catch (error) {
                console.error('Load Spotify artist error:', error);
                document.getElementById('artist-container').innerHTML = '<h2 class="text-center">Error loading artist</h2>';
            }
        }
        // ---------- Load Kick Channel ----------
        async function loadKickChannel(slug) {
            try {
                const response = await fetch(`https://kick.com/api/v2/channels/${slug}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch Kick channel');
                }
                const data = await response.json();
                const channel = data;
                currentArtist = channel;
                currentBio = await getWikipediaBio(channel.user.username);
                currentSocial = await getWikipediaSocial(channel.user.username);
                const isAdmin = currentUser && currentUser.email === ADMIN_EMAIL;
                const adminActions = isAdmin ? `<div class="admin-actions"><button onclick="importArtist()" title="Import"><i class="bi bi-plus"></i></button></div>` : '';
                const verifiedBadge = channel.verified ? '<i class="bi bi-check-circle-fill verified-badge"></i>' : '';
                const artistStats = `<div class="artist-stats"><h3>Gamer Stats</h3><p>Followers: ${channel.followers_count}</p></div>`;
                const html = `
                    <div class="artist-hero" style="background-image: url('${channel.banner_url || channel.user.profilepic || 'https://via.placeholder.com/1920x1080/141414/ffffff?text=Gamer+Photo'}');">
                        <div class="artist-hero-content">
                            ${adminActions}
                            <h1>${channel.slug}${verifiedBadge}</h1>
                            <div class="social-links">
                                <a href="https://kick.com/${channel.slug}" target="_blank" rel="noopener noreferrer"><i class="bi bi-joystick"></i></a>
                                ${currentSocial.instagram ? `<a href="${currentSocial.instagram}" target="_blank" rel="noopener noreferrer"><i class="bi bi-instagram"></i></a>` : ''}
                                ${currentSocial.x ? `<a href="${currentSocial.x}" target="_blank" rel="noopener noreferrer"><i class="bi bi-twitter"></i></a>` : ''}
                                ${currentSocial.facebook ? `<a href="${currentSocial.facebook}" target="_blank" rel="noopener noreferrer"><i class="bi bi-facebook"></i></a>` : ''}
                                ${currentSocial.tiktok ? `<a href="${currentSocial.tiktok}" target="_blank" rel="noopener noreferrer"><i class="bi bi-tiktok"></i></a>` : ''}
                                ${currentSocial.youtube ? `<a href="${currentSocial.youtube}" target="_blank" rel="noopener noreferrer"><i class="bi bi-youtube"></i></a>` : ''}
                                ${currentSocial.soundcloud ? `<a href="${currentSocial.soundcloud}" target="_blank" rel="noopener noreferrer"><i class="bi bi-soundwave"></i></a>` : ''}
                                <a href="#" data-bs-toggle="modal" data-bs-target="#shareModal"><i class="bi bi-qr-code-scan"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="ad-container-wrapper"><div id="ad-container"></div></div>
                    <div class="container">
                        <div class="artist-bio">
                            <h3>Biography</h3>
                            <p>${currentBio}</p>
                        </div>
                        ${artistStats}
                        <div class="products-section mt-4" style="display: none;"></div> <!-- No products -->
                        <div class="tracks-section mt-4">
                            <h3 id="tracks-header">Clips</h3>
                            <div id="tracks-row" class="d-flex flex-nowrap overflow-auto gap-3 pb-3"></div>
                        </div>
                    </div>
                `;
                document.getElementById('artist-container').innerHTML = html;
                await loadKickClips(slug);
            } catch (error) {
                console.error('Load Kick channel error:', error);
                document.getElementById('artist-container').innerHTML = '<h2 class="text-center">Error loading gamer</h2>';
            }
        }
        // ---------- Auth: For Admin UI and Profile ----------
        onAuthStateChanged(auth, user => {
            currentUser = user;
            updateProfileUI(user);
            if (artistId || spotifyId || kickId) {
                if (artistId) {
                    loadLocalArtist(artistId);
                } else if (spotifyId) {
                    loadSpotifyArtist(spotifyId);
                } else if (kickId) {
                    loadKickChannel(kickId);
                }
            }
        });
        // ---------- Start Loading Immediately (Public Access) ----------
        artistId = getQueryParam('artist');
        spotifyId = getQueryParam('spotify');
        kickId = getQueryParam('kick');
        if (artistId) {
            loadLocalArtist(artistId);
        } else if (spotifyId) {
            loadSpotifyArtist(spotifyId);
        } else if (kickId) {
            loadKickChannel(kickId);
        } else {
            document.getElementById('artist-container').innerHTML = '<h2 class="text-center">No artist specified</h2>';
        }
        // ---------- Admin Button Handlers ----------
        window.editArtist = (id) => {
            artistId = id; // Set global for submit
            if (!currentArtist) return;
            document.getElementById('editModalLabel').textContent = 'Edit Artist';
            document.getElementById('name').value = currentArtist.name || '';
            document.getElementById('description').value = currentArtist.description || '';
            document.getElementById('imageUrl').value = currentArtist.imageUrl || '';
            document.getElementById('instagram').value = currentArtist.instagram || '';
            document.getElementById('spotify').value = currentArtist.spotify || '';
            document.getElementById('kick').value = currentArtist.kick || '';
            document.getElementById('tiktok').value = currentArtist.tiktok || '';
            document.getElementById('youtube').value = currentArtist.youtube || '';
            document.getElementById('googlePlay').value = currentArtist.googlePlay || '';
            document.getElementById('appleMusic').value = currentArtist.appleMusic || '';
            document.getElementById('personalWebsite').value = currentArtist.personalWebsite || '';
            document.getElementById('x').value = currentArtist.x || '';
            document.getElementById('snapchat').value = currentArtist.snapchat || '';
            document.getElementById('whatsapp').value = currentArtist.whatsapp || '';
            document.getElementById('facebook').value = currentArtist.facebook || '';
            document.getElementById('soundcloud').value = currentArtist.soundcloud || '';
            document.getElementById('appstore').value = currentArtist.appstore || '';
            document.getElementById('verified').checked = currentArtist.verified || false;
            const editModal = new bootstrap.Modal(document.getElementById('editModal'));
            editModal.show();
        };
        window.importArtist = () => {
            artistId = null; // Set to null for add
            if (!currentArtist) return;
            document.getElementById('editModalLabel').textContent = 'Import Artist';
            if (spotifyId) {
                document.getElementById('name').value = currentArtist.name || '';
                document.getElementById('description').value = currentBio || '';
                document.getElementById('imageUrl').value = currentArtist.images[0]?.url || '';
                document.getElementById('instagram').value = currentSocial.instagram || '';
                document.getElementById('spotify').value = currentArtist.external_urls.spotify || '';
                document.getElementById('kick').value = '';
                document.getElementById('tiktok').value = currentSocial.tiktok || '';
                document.getElementById('youtube').value = currentSocial.youtube || '';
                document.getElementById('googlePlay').value = '';
                document.getElementById('appleMusic').value = '';
                document.getElementById('personalWebsite').value = '';
                document.getElementById('x').value = currentSocial.x || '';
                document.getElementById('snapchat').value = '';
                document.getElementById('whatsapp').value = '';
                document.getElementById('facebook').value = currentSocial.facebook || '';
                document.getElementById('soundcloud').value = currentSocial.soundcloud || '';
                document.getElementById('appstore').value = '';
                document.getElementById('verified').checked = true;
            } else if (kickId) {
                document.getElementById('name').value = currentArtist.user.username || '';
                document.getElementById('description').value = currentBio || '';
                document.getElementById('imageUrl').value = currentArtist.user.profilepic || '';
                document.getElementById('instagram').value = currentSocial.instagram || '';
                document.getElementById('spotify').value = '';
                document.getElementById('kick').value = `https://kick.com/${currentArtist.slug}` || '';
                document.getElementById('tiktok').value = currentSocial.tiktok || '';
                document.getElementById('youtube').value = currentSocial.youtube || '';
                document.getElementById('googlePlay').value = '';
                document.getElementById('appleMusic').value = '';
                document.getElementById('personalWebsite').value = '';
                document.getElementById('x').value = currentSocial.x || '';
                document.getElementById('snapchat').value = '';
                document.getElementById('whatsapp').value = '';
                document.getElementById('facebook').value = currentSocial.facebook || '';
                document.getElementById('soundcloud').value = currentSocial.soundcloud || '';
                document.getElementById('appstore').value = '';
                document.getElementById('verified').checked = true;
            }
            const editModal = new bootstrap.Modal(document.getElementById('editModal'));
            editModal.show();
        };
        window.deleteArtist = async (id) => {
            if (confirm('Are you sure you want to delete this artist?')) {
                try {
                    await deleteDoc(doc(db, 'artists', id));
                    window.location.href = 'index.html';
                } catch (error) {
                    console.error('Delete error:', error);
                    alert('Failed to delete artist: ' + error.message);
                }
            }
        };
        window.loginWithGoogle = loginWithGoogle;
        // ---------- Copy Link Function ----------
        window.copyLink = () => {
            const input = document.getElementById('profile-link-input');
            input.select();
            document.execCommand('copy');
            alert('Link copied to clipboard!');
        };
        // ---------- Search Event Listener ----------
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('searchInput');
            const searchType = document.getElementById('searchType');
            if (searchInput && searchType) {
                const performSearch = (e) => {
                    const searchTerm = e.target.value.trim();
                    const type = searchType.value;
                    if (type === 'local') {
                        searchLocalArtists(searchTerm);
                    } else if (type === 'spotify') {
                        searchSpotifyArtists(searchTerm);
                    } else if (type === 'kick') {
                        searchKickGamers(searchTerm);
                    }
                };
                searchInput.addEventListener('input', performSearch);
                searchType.addEventListener('change', () => {
                    const searchTerm = searchInput.value.trim();
                    performSearch({ target: { value: searchTerm } });
                });
            }
            const editForm = document.getElementById('editForm');
            if (editForm) {
                editForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    let updatedData = {
                        name: document.getElementById('name').value,
                        description: document.getElementById('description').value,
                        instagram: document.getElementById('instagram').value,
                        spotify: document.getElementById('spotify').value,
                        kick: document.getElementById('kick').value,
                        tiktok: document.getElementById('tiktok').value,
                        youtube: document.getElementById('youtube').value,
                        googlePlay: document.getElementById('googlePlay').value,
                        appleMusic: document.getElementById('appleMusic').value,
                        personalWebsite: document.getElementById('personalWebsite').value,
                        x: document.getElementById('x').value,
                        snapchat: document.getElementById('snapchat').value,
                        whatsapp: document.getElementById('whatsapp').value,
                        facebook: document.getElementById('facebook').value,
                        soundcloud: document.getElementById('soundcloud').value,
                        appstore: document.getElementById('appstore').value,
                        verified: document.getElementById('verified').checked,
                        views: 0
                    };
                    const imageFile = document.getElementById('imageFile').files[0];
                    if (imageFile) {
                        try {
                            const storageRef = ref(storage, `artists/${imageFile.name}`); // For new, no id yet
                            await uploadBytes(storageRef, imageFile);
                            updatedData.imageUrl = await getDownloadURL(storageRef);
                        } catch (error) {
                            console.error('Image upload error:', error);
                            alert('Failed to upload image: ' + error.message);
                            return;
                        }
                    } else {
                        updatedData.imageUrl = document.getElementById('imageUrl').value;
                    }
                    try {
                        if (artistId) {
                            await updateDoc(doc(db, 'artists', artistId), updatedData);
                            loadLocalArtist(artistId);
                        } else {
                            const newRef = await addDoc(collection(db, 'artists'), updatedData);
                            window.location.href = `artistpage.html?artist=${newRef.id}`;
                        }
                        bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
                    } catch (error) {
                        console.error('Save error:', error);
                        alert('Failed to save artist: ' + error.message);
                    }
                });
            }
            const addProductForm = document.getElementById('addProductForm');
            if (addProductForm) {
                addProductForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const title = document.getElementById('productTitle').value;
                    const description = document.getElementById('productDesc').value;
                    const price = parseFloat(document.getElementById('productPrice').value);
                    const picFile = document.getElementById('productPic').files[0];
                    if (!picFile) {
                        alert('Please upload a picture.');
                        return;
                    }
                    try {
                        const storageRef = ref(storage, `products/${artistId}/${picFile.name}`);
                        await uploadBytes(storageRef, picFile);
                        const picUrl = await getDownloadURL(storageRef);
                        await addDoc(collection(db, `artists/${artistId}/products`), {
                            title,
                            description,
                            price,
                            picUrl
                        });
                        bootstrap.Modal.getInstance(document.getElementById('addProductModal')).hide();
                        // Reset form
                        addProductForm.reset();
                        // Reload products
                        loadProducts(artistId);
                    } catch (error) {
                        console.error('Add product error:', error);
                        alert('Failed to add product: ' + error.message);
                    }
                });
            }
            // ---------- Share Modal QR Generation ----------
            const shareModal = document.getElementById('shareModal');
            if (shareModal) {
                shareModal.addEventListener('shown.bs.modal', () => {
                    const qrContainer = document.getElementById('qr-code');
                    qrContainer.innerHTML = '';
                    const profileUrl = window.location.href;
                    new QRCode(qrContainer, {
                        text: profileUrl,
                        width: 200,
                        height: 200,
                        colorDark: "#ffffff",
                        colorLight: "#141414"
                    });
                    document.getElementById('profile-link-input').value = profileUrl;
                });
            }
        });
    </script>
    <!-- Ad Script -->
    <script type="text/javascript">
        atOptions = { 'key' : '6819d716a99f588efc7f8dacfbc474bb', 'format' : 'iframe', 'height' : 90, 'width' : 728, 'params' : {} };
        document.addEventListener('DOMContentLoaded', () => {
            const c = document.getElementById('ad-container');
            if (c) {
                const s = document.createElement('script');
                s.src = 'https://www.highperformanceformat.com/6819d716a99f588efc7f8dacfbc474bb/invoke.js';
                s.async = true;
                c.appendChild(s);
            }
        });
    </script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>






