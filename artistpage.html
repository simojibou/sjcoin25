<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SJ X N41 music - Artist</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Custom CSS (Netflix-inspired) -->
    <style>
        :root{
            --color-red: #e50914; /* Netflix red */
            --color-white: #ffffff;
            --color-dark: #141414; /* Netflix primary dark */
            --color-dark-light: #221f1f; /* Slightly lighter dark for accents */
            --color-grey: #8c8c8c; /* For secondary text */
            --space-unit: 16px; /* Larger spacing for Netflix feel */
            --space-1: calc(var(--space-unit) * 1);
            --space-2: calc(var(--space-unit) * 2);
            --space-3: calc(var(--space-unit) * 3);
        }
        body{
            background: var(--color-dark);
            color: var(--color-white);
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; /* Netflix-like font stack */
            margin: 0;
            padding-top: 56px; /* Padding for fixed navbar */
            overflow-x: hidden;
        }
        .navbar{
            background-color: var(--color-dark) !important;
        }
        .navbar-brand{
            color: var(--color-red);
            font-weight: bold;
            font-size: 1.5rem;
        }
        .navbar-brand:hover{
            color: var(--color-red);
        }
        .nav-link{
            color: var(--color-white) !important;
            font-weight: 500;
        }
        .nav-link:hover{
            color: var(--color-grey) !important;
        }
        .nav-link.active{
            color: var(--color-white) !important;
            font-weight: bold;
        }
        .artist-hero{
            position: relative;
            height: 70vh; /* Taller hero for dramatic Netflix effect */
            width: 100%;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: flex-end; /* Align content to bottom like Netflix banners */
            justify-content: flex-start;
            text-align: left;
            margin-bottom: var(--space-3);
            padding: var(--space-3) var(--space-3) var(--space-2);
        }
        .artist-hero::before{
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(20,20,20,0), rgba(20,20,20,1)); /* Netflix fade to black */
            z-index: 1;
        }
        .artist-hero-content{
            position: relative;
            z-index: 2;
            max-width: 50%;
        }
        .artist-hero h1{
            font-size: 4rem; /* Larger, bold titles */
            font-weight: 700;
            letter-spacing: -1px;
            color: var(--color-white);
            margin-bottom: var(--space-1);
            text-shadow: 0 2px 4px rgba(0,0,0,0.5); /* Subtle shadow for readability */
        }
        .artist-hero .social-links{
            font-size: 1.5rem;
        }
        .artist-bio{
            max-width: 90%;
            margin: 0 auto;
            padding: var(--space-2);
            background: var(--color-dark-light);
            border-radius: 4px; /* Minimal rounding like Netflix cards */
        }
        .artist-bio h3{
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: var(--space-1);
        }
        .artist-bio p{
            font-size: 1rem;
            line-height: 1.6;
            color: var(--color-grey); /* Secondary text color */
        }
        .artist-stats{
            max-width: 90%;
            margin: var(--space-3) auto;
            padding: var(--space-2);
            background: var(--color-dark-light);
            border-radius: 4px;
        }
        .artist-stats h3{
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: var(--space-1);
        }
        .artist-stats p{
            font-size: 1rem;
            color: var(--color-grey);
        }
        .admin-actions{
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 3;
        }
        .admin-actions button{
            background: none;
            border: none;
            color: var(--color-white);
            margin-left: 10px;
            cursor: pointer;
            font-size: 1.5rem;
        }
        .admin-actions button:hover{
            color: var(--color-red);
        }
        .social-links a{
            color: var(--color-grey);
            margin-right: 12px;
            font-size: 1.5rem;
            transition: color .3s;
        }
        .social-links a:hover{
            color: var(--color-red);
        }
        .ad-container-wrapper{
            display: flex;
            justify-content: center;
            margin: var(--space-2) auto;
        }
        #ad-container{
            width: 728px; /* Wider ad for Netflix-like layout */
            height: 90px;
            max-width: 100%;
        }
        .btn-secondary{
            background-color: var(--color-red);
            border: none;
            font-weight: 600;
            padding: 10px 20px;
            border-radius: 4px;
        }
        .btn-secondary:hover{
            background-color: #b20710; /* Darker red on hover */
        }
        /* Profile image style */
        #profile-link img {
            object-fit: cover;
        }
        /* Search results style - Netflix-like cards */
        .search-result-card {
            transition: transform 0.2s;
        }
        .search-result-card:hover {
            transform: scale(1.05);
        }
        .search-result-card img {
            aspect-ratio: 2/3; /* Poster-like aspect ratio */
            object-fit: cover;
        }
        .search-result-card .card-body {
            text-align: center;
        }
        /* Mobile tweaks */
        @media (max-width: 768px){
            .artist-hero{
                height: 50vh;
                align-items: center;
                justify-content: center;
                text-align: center;
            }
            .artist-hero-content{
                max-width: 90%;
            }
            .artist-hero h1{
                font-size: 2.5rem;
            }
            .artist-bio{
                max-width: 95%;
            }
            #ad-container{
                width: 100%;
                height: auto;
            }
        }
        @media (max-width: 576px){
            .artist-hero h1{
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Netflix-inspired Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">SJ X N41</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Artists</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Playlists</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Albums</a>
                    </li>
                </ul>
                <ul class="navbar-nav mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#searchModal"><i class="bi bi-search"></i></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="bi bi-bell"></i></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="profile-link" href="#"><i class="bi bi-person-circle"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Search Modal -->
    <div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title" id="searchModalLabel">Search Artists</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="searchInput" class="form-control bg-dark text-white" placeholder="Search for artists...">
                    <div id="searchResults" class="row mt-3 gy-3"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edit Artist</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <div class="mb-3">
                            <label for="name" class="form-label">Name</label>
                            <input type="text" class="form-control bg-dark text-white" id="name" required>
                        </div>
                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control bg-dark text-white" id="description" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="imageUrl" class="form-label">Image URL</label>
                            <input type="url" class="form-control bg-dark text-white" id="imageUrl">
                        </div>
                        <div class="mb-3">
                            <label for="instagram" class="form-label">Instagram</label>
                            <input type="url" class="form-control bg-dark text-white" id="instagram">
                        </div>
                        <div class="mb-3">
                            <label for="spotify" class="form-label">Spotify</label>
                            <input type="url" class="form-control bg-dark text-white" id="spotify">
                        </div>
                        <div class="mb-3">
                            <label for="tiktok" class="form-label">TikTok</label>
                            <input type="url" class="form-control bg-dark text-white" id="tiktok">
                        </div>
                        <div class="mb-3">
                            <label for="youtube" class="form-label">YouTube</label>
                            <input type="url" class="form-control bg-dark text-white" id="youtube">
                        </div>
                        <div class="mb-3">
                            <label for="googlePlay" class="form-label">Google Play</label>
                            <input type="url" class="form-control bg-dark text-white" id="googlePlay">
                        </div>
                        <div class="mb-3">
                            <label for="appleMusic" class="form-label">Apple Music</label>
                            <input type="url" class="form-control bg-dark text-white" id="appleMusic">
                        </div>
                        <div class="mb-3">
                            <label for="personalWebsite" class="form-label">Personal Website</label>
                            <input type="url" class="form-control bg-dark text-white" id="personalWebsite">
                        </div>
                        <div class="mb-3">
                            <label for="x" class="form-label">X (Twitter)</label>
                            <input type="url" class="form-control bg-dark text-white" id="x">
                        </div>
                        <div class="mb-3">
                            <label for="snapchat" class="form-label">Snapchat</label>
                            <input type="url" class="form-control bg-dark text-white" id="snapchat">
                        </div>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Main Content -->
    <div id="artist-container" class="container-fluid p-0"> <!-- Full-width for Netflix feel -->
        <!-- Artist content will be injected here -->
    </div>
    <!-- Firebase SDKs (Modular) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, increment, collection, query, where, orderBy, startAt, endAt, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        const firebaseConfig = {
            apiKey: "AIzaSyD-sneIBO65i9uQIh3n_jw4MI7GQtjZfV8",
            authDomain: "sj-one.firebaseapp.com",
            databaseURL: "https://sj-one-default-rtdb.firebaseio.com",
            projectId: "sj-one",
            storageBucket: "sj-one.appspot.com",
            messagingSenderId: "426335553508",
            appId: "1:426335553508:web:248f76772f6f78419ca9f1",
            measurementId: "G-YQTVZQWXGB"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const ADMIN_EMAIL = 'simo.jibou@gmail.com';
        let currentUser = null;
        let artistId = null;
        let currentArtist = null;
        // ---------- Helper ----------
        function getQueryParam(name) {
            return new URLSearchParams(window.location.search).get(name);
        }
        // ---------- Login with Google ----------
        async function loginWithGoogle() {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                console.error('Login error:', error);
            }
        }
        // ---------- Update Profile UI ----------
        function updateProfileUI(user) {
            const profileLink = document.getElementById('profile-link');
            if (user) {
                profileLink.innerHTML = `<img src="${user.photoURL || 'https://via.placeholder.com/32?text=U'}" class="rounded-circle" width="32" height="32" alt="Profile">`;
                profileLink.onclick = null; // Could add profile dropdown later
            } else {
                profileLink.innerHTML = `<i class="bi bi-person-circle"></i>`;
                profileLink.onclick = loginWithGoogle;
            }
        }
        // ---------- Search Artists (Case-insensitive hack: query both lower and capitalized) ----------
        async function searchArtists(searchTerm) {
            const resultsContainer = document.getElementById('searchResults');
            resultsContainer.innerHTML = '';
            if (!searchTerm) return;
            const lowerTerm = searchTerm.toLowerCase();
            const capTerm = searchTerm.charAt(0).toUpperCase() + searchTerm.slice(1).toLowerCase();
            const queries = [];
            if (lowerTerm !== capTerm) {
                queries.push(query(collection(db, 'artists'), orderBy('name'), startAt(capTerm), endAt(capTerm + '\uf8ff')));
            }
            queries.push(query(collection(db, 'artists'), orderBy('name'), startAt(lowerTerm), endAt(lowerTerm + '\uf8ff')));
            let artists = new Map(); // To avoid duplicates
            try {
                for (const q of queries) {
                    const snapshot = await getDocs(q);
                    snapshot.forEach(doc => {
                        const artist = doc.data();
                        const id = doc.id;
                        if (!artists.has(id)) {
                            artists.set(id, {id, artist});
                        }
                    });
                }
                if (artists.size === 0) {
                    resultsContainer.innerHTML = '<p class="text-center text-muted">No artists found.</p>';
                    return;
                }
                artists.forEach(({id, artist}) => {
                    const card = `
                        <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                            <a href="artistpage.html?artist=${id}" class="text-decoration-none">
                                <div class="card bg-dark border-0 search-result-card">
                                    <img src="${artist.imageUrl || 'https://via.placeholder.com/200x300/141414/ffffff?text=Artist'}" class="card-img-top" alt="${artist.name}">
                                    <div class="card-body p-2">
                                        <h6 class="card-title text-white">${artist.name}</h6>
                                    </div>
                                </div>
                            </a>
                        </div>
                    `;
                    resultsContainer.innerHTML += card;
                });
            } catch (error) {
                console.error('Search error:', error);
                resultsContainer.innerHTML = '<p class="text-center text-danger">Error searching artists.</p>';
            }
        }
        // ---------- Load Artist (Public + Admin) ----------
        async function loadSingleArtist(id) {
            const artistRef = doc(db, 'artists', id);
            const snap = await getDoc(artistRef);
            if (!snap.exists()) {
                document.getElementById('artist-container').innerHTML = '<h2 class="text-center">Artist not found</h2>';
                return;
            }
            let artist = snap.data();
            // Attempt to increment views (for all users, but catch if permission denied)
            try {
                await updateDoc(artistRef, { views: increment(1) });
                // Get updated data
                const updatedSnap = await getDoc(artistRef);
                artist = updatedSnap.data();
            } catch (e) {
                console.error('Failed to increment views:', e);
                // Proceed with original data
            }
            currentArtist = artist;
            // Check if current user is admin
            const isAdmin = currentUser && currentUser.email === ADMIN_EMAIL;
            const adminActions = isAdmin
                ? `<div class="admin-actions">
                       <button onclick="editArtist('${id}')" title="Edit"><i class="bi bi-pencil"></i></button>
                       <button onclick="deleteArtist('${id}')" title="Delete"><i class="bi bi-trash"></i></button>
                   </div>`
                : '';
            const artistStats = `
                <div class="artist-stats">
                    <h3>Artist Stats</h3>
                    <p>Total Views: ${artist.views || 0}</p>
                    ${isAdmin ? `<p>Earnings: $${((artist.views || 0) / 1000).toFixed(2)}</p>` : ''}
                </div>`;
            const html = `
                <div class="artist-hero" style="background-image: url('${artist.imageUrl || 'https://via.placeholder.com/1920x1080/141414/ffffff?text=Artist+Photo'}');">
                    <div class="artist-hero-content">
                        ${adminActions}
                        <h1>${artist.name}</h1> <!-- Removed icon for cleaner Netflix look -->
                        <div class="social-links">
                            ${artist.instagram ? `<a href="${artist.instagram}" target="_blank" rel="noopener noreferrer"><i class="bi bi-instagram"></i></a>` : ''}
                            ${artist.spotify ? `<a href="${artist.spotify}" target="_blank" rel="noopener noreferrer"><i class="bi bi-spotify"></i></a>` : ''}
                            ${artist.tiktok ? `<a href="${artist.tiktok}" target="_blank" rel="noopener noreferrer"><i class="bi bi-tiktok"></i></a>` : ''}
                            ${artist.youtube ? `<a href="${artist.youtube}" target="_blank" rel="noopener noreferrer"><i class="bi bi-youtube"></i></a>` : ''}
                            ${artist.googlePlay ? `<a href="${artist.googlePlay}" target="_blank" rel="noopener noreferrer"><i class="bi bi-google"></i></a>` : ''}
                            ${artist.appleMusic ? `<a href="${artist.appleMusic}" target="_blank" rel="noopener noreferrer"><i class="bi bi-apple"></i></a>` : ''}
                            ${artist.personalWebsite ? `<a href="${artist.personalWebsite}" target="_blank" rel="noopener noreferrer"><i class="bi bi-globe"></i></a>` : ''}
                            ${artist.x ? `<a href="${artist.x}" target="_blank" rel="noopener noreferrer"><i class="bi bi-twitter"></i></a>` : ''}
                            ${artist.snapchat ? `<a href="${artist.snapchat}" target="_blank" rel="noopener noreferrer"><i class="bi bi-snapchat"></i></a>` : ''}
                        </div>
                    </div>
                </div>
                <div class="ad-container-wrapper"><div id="ad-container"></div></div>
                <div class="container">
                    <div class="artist-bio">
                        <h3>Biography</h3>
                        <p>${artist.description || 'Emerging talent in the music scene.'}</p>
                    </div>
                    ${artistStats}
                    <div class="text-center mt-4">
                        <a href="index.html" class="btn btn-secondary">Back to Home</a>
                    </div>
                </div>
            `;
            document.getElementById('artist-container').innerHTML = html;
        }
        // ---------- Auth: For Admin UI and Profile ----------
        onAuthStateChanged(auth, user => {
            currentUser = user;
            updateProfileUI(user);
            if (artistId) {
                loadSingleArtist(artistId); // Reload to show/hide admin tools
            }
        });
        // ---------- Start Loading Immediately (Public Access) ----------
        artistId = getQueryParam('artist');
        if (artistId) {
            loadSingleArtist(artistId); // Load even if not logged in
        } else {
            document.getElementById('artist-container').innerHTML = '<h2 class="text-center">No artist specified</h2>';
        }
        // ---------- Admin Button Handlers ----------
        window.editArtist = (id) => {
            if (!currentArtist) return;
            document.getElementById('name').value = currentArtist.name || '';
            document.getElementById('description').value = currentArtist.description || '';
            document.getElementById('imageUrl').value = currentArtist.imageUrl || '';
            document.getElementById('instagram').value = currentArtist.instagram || '';
            document.getElementById('spotify').value = currentArtist.spotify || '';
            document.getElementById('tiktok').value = currentArtist.tiktok || '';
            document.getElementById('youtube').value = currentArtist.youtube || '';
            document.getElementById('googlePlay').value = currentArtist.googlePlay || '';
            document.getElementById('appleMusic').value = currentArtist.appleMusic || '';
            document.getElementById('personalWebsite').value = currentArtist.personalWebsite || '';
            document.getElementById('x').value = currentArtist.x || '';
            document.getElementById('snapchat').value = currentArtist.snapchat || '';
            const editModal = new bootstrap.Modal(document.getElementById('editModal'));
            editModal.show();
        };
        window.deleteArtist = async (id) => {
            if (confirm('Are you sure you want to delete this artist?')) {
                try {
                    await deleteDoc(doc(db, 'artists', id));
                    window.location.href = 'index.html';
                } catch (error) {
                    console.error('Delete error:', error);
                    alert('Failed to delete artist.');
                }
            }
        };
        window.loginWithGoogle = loginWithGoogle;
        // ---------- Search Event Listener ----------
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.trim();
                    searchArtists(searchTerm);
                });
            }
            const editForm = document.getElementById('editForm');
            if (editForm) {
                editForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const updatedData = {
                        name: document.getElementById('name').value,
                        description: document.getElementById('description').value,
                        imageUrl: document.getElementById('imageUrl').value,
                        instagram: document.getElementById('instagram').value,
                        spotify: document.getElementById('spotify').value,
                        tiktok: document.getElementById('tiktok').value,
                        youtube: document.getElementById('youtube').value,
                        googlePlay: document.getElementById('googlePlay').value,
                        appleMusic: document.getElementById('appleMusic').value,
                        personalWebsite: document.getElementById('personalWebsite').value,
                        x: document.getElementById('x').value,
                        snapchat: document.getElementById('snapchat').value,
                    };
                    try {
                        await updateDoc(doc(db, 'artists', artistId), updatedData);
                        bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
                        loadSingleArtist(artistId);
                    } catch (error) {
                        console.error('Update error:', error);
                        alert('Failed to update artist.');
                    }
                });
            }
        });
    </script>
    <!-- Ad Script -->
    <script type="text/javascript">
        atOptions = { 'key' : '6819d716a99f588efc7f8dacfbc474bb', 'format' : 'iframe', 'height' : 90, 'width' : 728, 'params' : {} };
        document.addEventListener('DOMContentLoaded', () => {
            const c = document.getElementById('ad-container');
            if (c) {
                const s = document.createElement('script');
                s.src = 'https://www.highperformanceformat.com/6819d716a99f588efc7f8dacfbc474bb/invoke.js';
                s.async = true;
                c.appendChild(s);
            }
        });
    </script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
